<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YCV5KGB8ES"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YCV5KGB8ES');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Sharding vs PostgreSQL Partitioning - Interactive Demo</title>
    <link rel="stylesheet" href="shared-theme.css">
    <style>
        /* Page-specific styles that extend shared-theme.css */

        /* Header */
        .demo-header {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 12px var(--shadow-md);
            margin-bottom: var(--space-xl);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .demo-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary-color), var(--secondary-hover));
        }

        .demo-header-content {
            padding: var(--space-2xl) var(--space-xl);
        }

        .demo-header h1 {
            color: var(--text-primary);
            margin-bottom: var(--space-md);
            font-size: var(--font-size-4xl);
            font-weight: var(--font-weight-bold);
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--secondary-hover) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .demo-subtitle {
            font-size: var(--font-size-lg);
            color: var(--text-secondary);
            font-weight: var(--font-weight-normal);
        }

        /* Real Impact Box */
        .real-impact-container {
            margin-bottom: var(--space-xl);
        }

        .real-impact-box {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: var(--text-inverse);
            padding: var(--space-xl);
            border-radius: var(--radius-lg);
            box-shadow: 0 8px 25px var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .real-impact-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary-color), var(--secondary-hover));
        }

        .real-impact-text {
            font-size: var(--font-size-lg);
            line-height: var(--line-height-relaxed);
            position: relative;
            z-index: 1;
        }

        /* Demo Overview */
        .demo-overview-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 12px var(--shadow-md);
            margin-bottom: var(--space-xl);
            overflow: hidden;
        }

        .demo-toggle-header {
            padding: var(--space-lg) var(--space-xl);
            background: var(--background-soft);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
        }

        .demo-toggle-header:hover {
            background: rgba(0, 237, 100, 0.05);
        }

        .demo-toggle-title {
            font-size: var(--font-size-xl);
            color: var(--text-primary);
            font-weight: var(--font-weight-semibold);
        }

        .demo-toggle-icon {
            font-size: var(--font-size-lg);
            transition: transform 0.3s ease;
            color: var(--text-secondary);
        }

        .demo-content {
            padding: var(--space-xl);
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
            margin-bottom: var(--space-lg);
        }

        .scenario-card {
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .mongo-scenario {
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.1) 0%, rgba(0, 184, 77, 0.05) 100%);
            border-color: var(--secondary-color);
        }

        .sql-scenario {
            background: linear-gradient(135deg, rgba(0, 108, 250, 0.1) 0%, rgba(79, 195, 247, 0.05) 100%);
            border-color: var(--accent-blue);
        }

        .scenario-title {
            margin-bottom: var(--space-md);
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
        }

        .mongo-title {
            color: var(--text-primary);
        }

        .sql-title {
            color: var(--accent-blue);
        }

        .scenario-list {
            list-style: none;
            padding-left: 0;
        }

        .scenario-list li {
            padding: var(--space-sm) 0;
            position: relative;
            padding-left: var(--space-lg);
            line-height: var(--line-height-normal);
        }

        .scenario-list li::before {
            content: "▶";
            position: absolute;
            left: 0;
            color: var(--secondary-color);
            font-size: var(--font-size-sm);
        }

        .key-differences {
            background: var(--background-soft);
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
        }

        .key-differences h4 {
            margin-bottom: var(--space-md);
            color: var(--text-primary);
            font-size: var(--font-size-lg);
        }

        .differences-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
        }

        .difference-point {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: 0 2px 6px var(--shadow-sm);
        }

        .point-icon {
            font-size: var(--font-size-3xl);
            width: 60px;
            text-align: center;
        }

        .point-title {
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
            font-size: var(--font-size-base);
            margin-bottom: var(--space-xs);
        }

        .point-description {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        /* Technical Sections */
        .technical-section {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: var(--space-xl);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 12px var(--shadow-md);
            margin-bottom: var(--space-xl);
        }

        .technical-section h4 {
            color: var(--primary-color);
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .strategy-card {
            background: var(--background-soft);
            border: 1px solid var(--border);
            padding: var(--space-lg);
            border-radius: var(--radius);
            box-shadow: 0 2px 6px var(--shadow-sm);
        }

        .strategy-card h5 {
            color: var(--text-primary);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-md);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: var(--space-sm);
        }

        .strategy-card p {
            margin-bottom: var(--space-sm);
            font-size: var(--font-size-sm);
            line-height: var(--line-height-normal);
        }

        .strategy-card p strong {
            color: var(--primary-color);
            font-weight: var(--font-weight-semibold);
        }

        .middleware-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-xl);
            margin-top: var(--space-lg);
        }

        .routing-side {
            background: var(--background-soft);
            border: 1px solid var(--border);
            padding: var(--space-lg);
            border-radius: var(--radius);
            box-shadow: 0 2px 6px var(--shadow-sm);
        }

        .routing-side.mongodb {
            border-left: 4px solid var(--primary-color);
        }

        .routing-side.postgresql {
            border-left: 4px solid var(--accent-orange);
        }

        .routing-side h5 {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .routing-side.mongodb h5 {
            color: var(--primary-color);
        }

        .routing-side.postgresql h5 {
            color: var(--accent-orange);
        }

        .routing-side ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .routing-side li {
            margin-bottom: var(--space-sm);
            padding-left: var(--space-md);
            position: relative;
            font-size: var(--font-size-sm);
            line-height: var(--line-height-normal);
        }

        .routing-side li::before {
            content: "→";
            position: absolute;
            left: 0;
            color: var(--secondary-color);
            font-weight: bold;
        }

        .routing-side li strong {
            color: var(--text-primary);
            font-weight: var(--font-weight-semibold);
        }

        .balance-note {
            background: var(--background-soft);
            border: 1px solid var(--border);
            border-left: 4px solid var(--accent-orange);
            padding: var(--space-lg);
            border-radius: var(--radius);
            margin-top: var(--space-lg);
        }

        .balance-note p {
            margin-bottom: var(--space-md);
            font-size: var(--font-size-sm);
            line-height: var(--line-height-normal);
        }

        .balance-note ul {
            margin: var(--space-sm) 0;
            padding-left: var(--space-lg);
        }

        .balance-note li {
            margin-bottom: var(--space-xs);
            font-size: var(--font-size-sm);
        }

        .balance-note code {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-family: var(--font-family-mono);
            font-size: var(--font-size-xs);
            color: var(--text-primary);
        }

        /* Responsive design for new sections */
        @media (max-width: 768px) {
            .middleware-comparison {
                grid-template-columns: 1fr;
            }
            
            .strategy-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Controls */
        .controls {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: var(--space-xl);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 12px var(--shadow-md);
            margin-bottom: var(--space-xl);
            text-align: center;
        }

        .controls h3 {
            margin-bottom: var(--space-lg);
            color: var(--text-primary);
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-lg);
            background: var(--secondary-color);
            color: var(--primary-color);
            text-decoration: none;
            border-radius: var(--radius);
            transition: var(--transition);
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-base);
            border: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            margin: 0 var(--space-sm) var(--space-sm) 0;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--secondary-hover) 0%, var(--primary-color) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .btn:hover::before {
            opacity: 1;
        }

        .btn:hover {
            color: var(--text-inverse);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 237, 100, 0.4);
        }

        .btn span {
            position: relative;
            z-index: 1;
        }

        /* Stats Container */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: var(--space-xl);
            border-radius: var(--radius-lg);
            text-align: center;
            box-shadow: 0 4px 12px var(--shadow-md);
            transition: var(--transition-slow);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary-color), var(--secondary-hover));
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px var(--shadow-lg);
        }

        .stat-number {
            font-size: var(--font-size-4xl);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
        }

        .stat-label {
            color: var(--text-secondary);
            font-weight: var(--font-weight-medium);
        }

        /* Commands Section */
        .commands-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 12px var(--shadow-md);
            margin-bottom: var(--space-xl);
            overflow: hidden;
        }

        .commands-section h3 {
            padding: var(--space-lg) var(--space-xl);
            background: var(--background-soft);
            margin: 0;
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
            font-weight: var(--font-weight-semibold);
        }

        .command-tabs {
            display: flex;
            background: var(--background-soft);
        }

        .tab-btn {
            flex: 1;
            padding: var(--space-lg);
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: var(--font-weight-semibold);
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            color: var(--text-secondary);
            font-size: var(--font-size-base);
        }

        .tab-btn.active {
            background: var(--surface);
            border-bottom-color: var(--secondary-color);
            color: var(--text-primary);
        }

        .tab-btn:hover:not(.active) {
            background: rgba(0, 237, 100, 0.05);
        }

        .tab-content {
            display: none;
            padding: var(--space-xl);
            background: #1e1e1e;
            color: #f8f8f2;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            line-height: var(--line-height-relaxed);
            white-space: pre-wrap;
            overflow-x: auto;
            font-size: var(--font-size-sm);
        }

        .tab-content.active {
            display: block;
        }

        /* Architecture */
        .architecture {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .arch-panel {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            box-shadow: 0 4px 12px var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .arch-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary-color), var(--secondary-hover));
        }

        .arch-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 2px solid var(--secondary-color);
            color: var(--text-primary);
        }

        .arch-title.sql {
            border-bottom-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .query-router, .sql-router {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: var(--text-inverse);
            padding: var(--space-md);
            border-radius: var(--radius);
            text-align: center;
            margin-bottom: var(--space-lg);
            font-weight: var(--font-weight-semibold);
            position: relative;
            overflow: hidden;
        }

        .sql-router {
            background: linear-gradient(135deg, var(--accent-blue) 0%, #1976D2 100%);
        }

        .query-router small, .sql-router small {
            display: block;
            font-size: var(--font-size-sm);
            margin-top: var(--space-sm);
            opacity: 0.9;
            font-weight: var(--font-weight-normal);
        }

        .shards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--space-md);
        }

        .shard {
            padding: var(--space-md);
            border-radius: var(--radius);
            text-align: center;
            font-size: var(--font-size-sm);
            transition: var(--transition);
            border: 2px solid;
            position: relative;
            overflow: hidden;
        }

        .shard.mongo {
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.1) 0%, rgba(0, 184, 77, 0.05) 100%);
            border-color: var(--secondary-color);
            color: var(--text-primary);
        }

        .shard.sql {
            background: linear-gradient(135deg, rgba(0, 108, 250, 0.1) 0%, rgba(79, 195, 247, 0.05) 100%);
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .shard.new-shard {
            animation: highlight 3s ease-in-out;
        }

        @keyframes highlight {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 0 25px rgba(0, 237, 100, 0.6); }
        }

        .shard-title {
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-sm);
            font-size: var(--font-size-base);
        }

        .shard-title.sql {
            color: var(--accent-blue);
        }

        /* Log Container */
        .log-container {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 12px var(--shadow-md);
            overflow: hidden;
            position: relative;
        }

        .log-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary-color), var(--secondary-hover));
        }

        .log-container h3 {
            padding: var(--space-lg) var(--space-xl);
            background: var(--background-soft);
            margin: 0;
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
            font-weight: var(--font-weight-semibold);
        }

        .log-content {
            height: 350px;
            overflow-y: auto;
            padding: var(--space-lg);
            background: #1e1e1e;
            color: #f8f8f2;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: var(--font-size-sm);
            line-height: var(--line-height-normal);
        }

        .log-entry {
            margin-bottom: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-sm);
            border-left: 3px solid transparent;
        }

        .log-entry.command {
            background: rgba(0, 237, 100, 0.15);
            border-left-color: var(--secondary-color);
        }

        .log-entry.sql {
            background: rgba(0, 108, 250, 0.15);
            border-left-color: var(--accent-blue);
        }

        /* Logo Icons */
        .mongodb-logo-icon::before {
            content: "🍃";
            margin-right: var(--space-sm);
        }

        .postgresql-logo-icon::before {
            content: "🐘";
            margin-right: var(--space-sm);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .scenario-grid,
            .differences-grid,
            .architecture {
                grid-template-columns: 1fr;
                gap: var(--space-md);
            }
        }

        @media (max-width: 768px) {
            .demo-header-content {
                padding: var(--space-xl) var(--space-lg);
            }
            
            .demo-header h1 {
                font-size: var(--font-size-3xl);
            }
            
            .demo-subtitle {
                font-size: var(--font-size-base);
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .btn {
                display: block;
                margin: var(--space-sm) 0;
                width: 100%;
            }
            
            .shards-container {
                grid-template-columns: 1fr;
            }
            
            .demo-content {
                padding: var(--space-md);
            }
        }

        @media (max-width: 480px) {
            .controls,
            .real-impact-box,
            .demo-content {
                padding: var(--space-md);
            }
            
            .difference-point {
                flex-direction: column;
                text-align: center;
                gap: var(--space-sm);
            }
        }

        /* Accessibility */
        button:focus,
        a:focus {
            outline: 3px solid var(--secondary-color);
            outline-offset: 2px;
        }

        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <header class="unified-header">
        <div class="header-content">
            <a href="playground.html" class="header-logo">
                <div class="logo-icon">M</div>
                <span>MongoDB Playground</span>
            </a>
            <div class="breadcrumb">
                <a href="playground.html">Playground</a>
                <span class="breadcrumb-separator">></span>
                <span>Scaling Demo</span>
            </div>
            <a href="playground.html" class="back-to-playground">← Back to Playground</a>
        </div>
    </header>

    <div class="page-container">
        <header class="demo-header">
            <div class="demo-header-content">
                <h1>
                    <span class="mongodb-logo-icon" aria-hidden="true"></span>MongoDB Sharding vs 
                    <span class="postgresql-logo-icon" aria-hidden="true"></span>PostgreSQL Partitioning
                </h1>
                <p class="demo-subtitle">Experience the difference between automatic horizontal scaling and manual partitioning</p>
            </div>
        </header>

        <!-- Real Impact Box -->
        <div class="real-impact-container">
            <div class="real-impact-box">
                <div class="real-impact-text">
                    <strong>Real Impact:</strong> MongoDB's automatic sharding reduces operational overhead by 90% compared to manual PostgreSQL partitioning, while providing seamless horizontal scaling and zero-downtime shard additions.
                </div>
            </div>
        </div>

        <!-- Technical Deep Dive Sections -->
        <div class="technical-section">
            <h4>🔧 Partitioning Strategies Deep Dive</h4>
            <p>Understanding the fundamental differences in how MongoDB sharding and PostgreSQL partitioning approach data distribution:</p>
            
            <div class="strategy-grid">
                <div class="strategy-card">
                    <h5>MongoDB Range-based Sharding</h5>
                    <p><strong>Strategy:</strong> Automatic chunk-based distribution using shard key ranges (e.g., user_id: 1-1000, 1001-2000, etc.)</p>
                    <p><strong>Chunk Management:</strong> MongoDB automatically splits chunks when they exceed 64MB or 100,000 documents</p>
                    <p><strong>Rebalancing:</strong> Built-in balancer continuously monitors and redistributes chunks across shards</p>
                    <p><strong>Shard Key Optimization:</strong> mongos analyzes query patterns to optimize chunk distribution</p>
                    <p><strong>Real-world Impact:</strong> Zero-downtime scaling with automatic load balancing maintains consistent performance</p>
                </div>
                
                <div class="strategy-card">
                    <h5>MongoDB Hash-based Sharding</h5>
                    <p><strong>Strategy:</strong> Hash function ensures even distribution regardless of shard key cardinality</p>
                    <p><strong>Use Case:</strong> Ideal for monotonically increasing keys (timestamps, ObjectIds) that would create hotspots</p>
                    <p><strong>Trade-offs:</strong> Range queries become scatter-gather operations, but writes are perfectly distributed</p>
                    <p><strong>Automatic Balancing:</strong> Hash distribution inherently prevents hotspots and uneven data growth</p>
                </div>
                
                <div class="strategy-card">
                    <h5>PostgreSQL Range Partitioning</h5>
                    <p><strong>Strategy:</strong> Manual table inheritance with CHECK constraints defining data ranges</p>
                    <p><strong>Routing Logic:</strong> Application or trigger functions must route data to correct partitions</p>
                    <p><strong>Scaling Process:</strong> Requires downtime for partition creation, index building, and constraint updates</p>
                    <p><strong>Rebalancing:</strong> Manual data migration required - no automatic redistribution mechanism</p>
                    <p><strong>Real-world Impact:</strong> Significant operational overhead and planned downtime for scaling operations</p>
                </div>
                
                <div class="strategy-card">
                    <h5>PostgreSQL Hash/List Partitioning</h5>
                    <p><strong>Hash Strategy:</strong> Built-in hash partitioning available in PostgreSQL 11+</p>
                    <p><strong>Limitation:</strong> Fixed number of partitions - cannot dynamically add partitions without table restructuring</p>
                    <p><strong>List Strategy:</strong> Explicit value-based partitioning for categorical data</p>
                    <p><strong>Operational Overhead:</strong> Still requires application-level awareness and manual partition management</p>
                </div>
            </div>
        </div>

        <div class="technical-section">
            <h4>⚡ Middleware & Routing Architecture Comparison</h4>
            <p>The architectural differences between MongoDB's mongos router and PostgreSQL's application-level routing solutions:</p>
            
            <div class="middleware-comparison">
                <div class="routing-side mongodb">
                    <h5>🍃 MongoDB mongos Router</h5>
                    <ul>
                        <li><strong>Native Query Router:</strong> mongos acts as intelligent proxy, completely transparent to applications</li>
                        <li><strong>Automatic Query Optimization:</strong> Determines optimal query execution plan across shards</li>
                        <li><strong>Connection Pooling:</strong> Built-in connection management and load balancing to shard replicas</li>
                        <li><strong>Metadata Management:</strong> Real-time config server synchronization for topology changes</li>
                        <li><strong>Query Types:</strong> 
                            <ul style="margin-top: 8px; padding-left: 16px;">
                                <li>Targeted queries route to specific shards</li>
                                <li>Scatter-gather for cross-shard aggregations</li>
                                <li>Broadcast for schema operations</li>
                            </ul>
                        </li>
                        <li><strong>Fault Tolerance:</strong> Automatic failover and retry logic built into router</li>
                        <li><strong>Zero Application Changes:</strong> Applications connect to mongos exactly like single MongoDB instance</li>
                    </ul>
                </div>
                
                <div class="routing-side postgresql">
                    <h5>🐘 PostgreSQL Routing Solutions</h5>
                    <ul>
                        <li><strong>pgpool-II:</strong> External connection pooler with limited query routing capabilities</li>
                        <li><strong>Application-Level Logic:</strong> Custom code required to determine target partition/server</li>
                        <li><strong>Connection Management:</strong> Manual connection pool configuration for each partition</li>
                        <li><strong>Query Complexity:</strong> Cross-partition queries require application-level joins and aggregation</li>
                        <li><strong>Distributed Transactions:</strong> 2PC required for cross-partition ACID compliance</li>
                        <li><strong>Configuration Overhead:</strong> 
                            <ul style="margin-top: 8px; padding-left: 16px;">
                                <li>Separate connection strings per partition</li>
                                <li>Load balancer rules for read distribution</li>
                                <li>Custom health check implementations</li>
                            </ul>
                        </li>
                        <li><strong>Scaling Impact:</strong> Every partition addition requires application deployment and configuration updates</li>
                    </ul>
                </div>
            </div>
            
            <div class="balance-note">
                <p><strong>Real-World Middleware Comparison:</strong></p>
                <p>While both architectures can achieve horizontal scaling, the operational complexity differs significantly:</p>
                <ul>
                    <li><strong>MongoDB:</strong> Single <code>sh.addShard()</code> command automatically updates all routing logic</li>
                    <li><strong>PostgreSQL:</strong> Requires updating connection pools, application config, load balancer rules, and potentially application logic</li>
                </ul>
                <p>The mongos router's intelligence allows it to optimize query execution dynamically, while PostgreSQL solutions typically require pre-planned query patterns and manual optimization.</p>
            </div>
        </div>

        <div class="technical-section">
            <h4>⚖️ Data Distribution Balance: The Reality</h4>
            <p>Addressing the critical concern about balanced vs. imbalanced data distribution in both systems:</p>
            
            <div class="balance-note">
                <p><strong>The PostgreSQL Partitioning Challenge:</strong></p>
                <p>While it's theoretically possible to achieve balanced partitions in PostgreSQL, the practical reality reveals significant operational challenges:</p>
                
                <ul>
                    <li><strong>Initial Balance ≠ Sustained Balance:</strong> Even with perfect initial partitioning, data growth patterns often create imbalances over time</li>
                    <li><strong>Rebalancing Complexity:</strong> Moving data between PostgreSQL partitions requires:
                        <ul style="margin-top: 8px;">
                            <li>Manual <code>INSERT INTO target_partition SELECT * FROM source_partition WHERE condition</code></li>
                            <li>Followed by <code>DELETE FROM source_partition WHERE condition</code></li>
                            <li>Transaction locks that can last hours for large datasets</li>
                            <li>Downtime for constraint updates and index rebuilding</li>
                        </ul>
                    </li>
                    <li><strong>Monitoring & Detection:</strong> No built-in tools to detect partition imbalances or suggest rebalancing strategies</li>
                </ul>
                
                <p><strong>MongoDB's Automatic Rebalancing:</strong></p>
                <ul>
                    <li><strong>Continuous Monitoring:</strong> Config servers track chunk distribution across shards in real-time</li>
                    <li><strong>Threshold-Based Balancing:</strong> Automatically triggers migration when shard imbalance exceeds configured thresholds</li>
                    <li><strong>Non-Blocking Operations:</strong> Chunk migrations happen in background without affecting read/write operations</li>
                    <li><strong>Adaptive Splitting:</strong> Chunks automatically split when they grow beyond size limits, preventing hotspots</li>
                </ul>
                
                <p><strong>Production Reality Example:</strong></p>
                <p>Consider an e-commerce platform with user_id-based partitioning. New user registrations create a "hot partition" in PostgreSQL that requires manual intervention. MongoDB's balancer detects this pattern and automatically redistributes chunks, maintaining consistent performance without operational overhead.</p>
            </div>
        </div>

        <!-- Expandable Demo Overview -->
        <div class="demo-overview-section">
            <div class="demo-toggle-header" onclick="toggleDemoOverview()">
                <h3 class="demo-toggle-title">📋 What This Demo Shows</h3>
                <span id="demoToggle" class="demo-toggle-icon">▼</span>
            </div>
            
            <div id="demoOverview" style="display: none;" class="demo-content">
                <div class="scenario-grid">
                    <div class="scenario-card mongo-scenario">
                        <h4 class="scenario-title mongo-title">🍃 MongoDB Sharding Scenario</h4>
                        <ul class="scenario-list">
                            <li>Automatic data distribution across multiple shards</li>
                            <li>Zero-downtime shard additions with automatic rebalancing</li>
                            <li>mongos router handles all query routing transparently</li>
                            <li>Built-in chunk migration and load balancing</li>
                            <li><strong>No application code changes required</strong></li>
                        </ul>
                    </div>
                    
                    <div class="scenario-card sql-scenario">
                        <h4 class="scenario-title sql-title">🐘 PostgreSQL Partitioning Scenario</h4>
                        <ul class="scenario-list">
                            <li>Manual table partitioning with explicit range definitions</li>
                            <li>Application-level routing logic required</li>
                            <li>Downtime needed for partition restructuring</li>
                            <li>Manual data migration between partitions</li>
                            <li><strong>Complex operational procedures</strong></li>
                        </ul>
                    </div>
                </div>
                
                <div class="key-differences">
                    <h4>🔍 Key Differences You'll Experience</h4>
                    <div class="differences-grid">
                        <div class="difference-point">
                            <div class="point-icon">⚡</div>
                            <div class="point-content">
                                <div class="point-title">Scaling Speed</div>
                                <div class="point-description">Instant vs. hours of planning and downtime</div>
                            </div>
                        </div>
                        <div class="difference-point">
                            <div class="point-icon">🔧</div>
                            <div class="point-content">
                                <div class="point-title">Operational Complexity</div>
                                <div class="point-description">Single commands vs. complex procedures</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <h3>🎮 Demo Controls</h3>
            <button class="btn btn-primary" onclick="addDataFinal()">
                <span>📈 Add 1000 Records</span>
            </button>
            <button class="btn btn-primary" onclick="addShardFinal()">
                <span>🔧 Add MongoDB Shard</span>
            </button>
            <button class="btn btn-primary" onclick="addPostgresPartition()">
                <span>🗄️ Add PostgreSQL Partition</span>
            </button>
            <button class="btn btn-primary" onclick="resetFinal()">
                <span>🔄 Reset Demo</span>
            </button>
        </div>

        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number" id="totalRecords">0</div>
                <div class="stat-label">Total Records</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="mongoShards">3</div>
                <div class="stat-label">MongoDB Shards</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="sqlPartitions">1</div>
                <div class="stat-label">SQL Partitions</div>
            </div>
        </div>

        <div class="commands-section">
            <h3>💻 Database Commands</h3>
            <div class="command-tabs">
                <button class="tab-btn active" onclick="showTabFinal('mongo')">MongoDB</button>
                <button class="tab-btn" onclick="showTabFinal('postgresql')">PostgreSQL</button>
            </div>
            <div id="mongo-content" class="tab-content active">// Current MongoDB sharding commands
sh.enableSharding("ecommerce")
sh.shardCollection("ecommerce.users", {"user_id": 1})

// Query routing (automatic)
db.users.find({"user_id": 12345})  // → Routes to correct shard
db.users.find({"city": "SF"})     // → Broadcast query

// Add new shard (what you're doing)
sh.addShard("shard004/new-region:27017")
// ✅ Automatic rebalancing, zero downtime</div>
            <div id="postgresql-content" class="tab-content">-- Current PostgreSQL partitioning commands
-- Creating new partition (what you're doing)
CREATE TABLE users_partition_3 (
    user_id INTEGER NOT NULL,
    email VARCHAR(255),
    name VARCHAR(255),
    created_at TIMESTAMP,
    CHECK (user_id >= 20001 AND user_id <= 30000)
) INHERITS (users);

-- Create indexes on new partition
CREATE INDEX idx_users_partition_3_id ON users_partition_3 (user_id);
CREATE INDEX idx_users_partition_3_email ON users_partition_3 (email);

-- Update trigger function for routing
CREATE OR REPLACE FUNCTION users_insert_trigger()
RETURNS TRIGGER AS $
BEGIN
    IF NEW.user_id >= 1 AND NEW.user_id <= 10000 THEN
        INSERT INTO users_partition_1 VALUES (NEW.*);
    ELSIF NEW.user_id >= 10001 AND NEW.user_id <= 20000 THEN
        INSERT INTO users_partition_2 VALUES (NEW.*);
    ELSIF NEW.user_id >= 20001 AND NEW.user_id <= 30000 THEN
        INSERT INTO users_partition_3 VALUES (NEW.*);
    ELSE
        RAISE EXCEPTION 'user_id out of range';
    END IF;
    RETURN NULL;
END;
$ LANGUAGE plpgsql;

-- Update application connection pool
-- ⚠️ Restart required for new partition recognition
-- ⚠️ NO automatic data rebalancing - existing data stays put!</div>
        </div>

        <div class="architecture">
            <div class="arch-panel">
                <div class="arch-title"><span class="mongodb-logo-icon"></span>MongoDB Sharded Cluster</div>
                
                <div class="query-router">
                    🎯 mongos Query Router
                    <small>Automatic routing & load balancing</small>
                </div>
                
                <div class="shards-container" id="mongoContainer">
                    <!-- Shards will be added here -->
                </div>
            </div>

            <div class="arch-panel">
                <div class="arch-title sql"><span class="postgresql-logo-icon"></span>PostgreSQL Manual Partitioning</div>
                
                <div class="sql-router">
                    ⚙️ Application Logic + pgpool
                    <small>Manual routing & connection pooling</small>
                </div>
                
                <div class="shards-container sql" id="sqlContainer">
                    <!-- SQL partitions will be added here dynamically -->
                </div>
            </div>
        </div>

        <div class="log-container">
            <h3>📊 Activity Log</h3>
            <div class="log-content" id="logContainer"></div>
        </div>
    </div>

    <script>
        // Global state
        var totalRecords = 0;
        var mongoShardCount = 3;
        var sqlPartitionCount = 1;
        var mongoData = { shard1: 0, shard2: 0, shard3: 0 };
        var sqlData = [0]; // Array to hold data per partition

        // LOG FUNCTION
        function logFinal(message, type) {
            var container = document.getElementById('logContainer');
            if (container) {
                var entry = document.createElement('div');
                entry.className = 'log-entry ' + (type || '');
                entry.textContent = '[' + new Date().toLocaleTimeString() + '] ' + message;
                container.appendChild(entry);
                container.scrollTop = container.scrollHeight;
            }
        }

        function updateStatsFinal() {
            document.getElementById('totalRecords').textContent = totalRecords.toLocaleString();
            document.getElementById('mongoShards').textContent = mongoShardCount;
            document.getElementById('sqlPartitions').textContent = sqlPartitionCount;
        }

        function showTabFinal(tabName) {
            // Hide all tabs
            document.getElementById('mongo-content').classList.remove('active');
            document.getElementById('postgresql-content').classList.remove('active');
            
            // Remove active from buttons
            var buttons = document.querySelectorAll('.tab-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            
            // Show selected tab
            document.getElementById(tabName + '-content').classList.add('active');
            event.target.classList.add('active');
        }

        function renderMongoShardsFinal() {
            var container = document.getElementById('mongoContainer');
            container.innerHTML = '';

            var locations = ['US-East', 'US-West', 'EU', 'Asia-Pacific', 'Canada', 'Australia', 'Brazil', 'India'];

            for (var i = 1; i <= mongoShardCount; i++) {
                var shard = document.createElement('div');
                shard.className = 'shard mongo';
                shard.id = 'mongoShard' + i;
                
                if (i === mongoShardCount && mongoShardCount > 3) {
                    shard.classList.add('new-shard');
                }

                var records = mongoData['shard' + i] || 0;
                var percentage = totalRecords > 0 ? Math.round((records / totalRecords) * 100) : 0;
                var location = locations[i - 1] || 'Region-' + i;
                
                // Calculate range for display
                var rangeStart = ((i - 1) * 10000) + 1;
                var rangeEnd = i * 10000;
                var rangeText = 'Range: ' + rangeStart + '-' + rangeEnd;

                shard.innerHTML = 
                    '<div class="shard-title">Shard ' + i + '</div>' +
                    '<div><strong>' + location + '</strong></div>' +
                    '<div>' + records.toLocaleString() + ' docs</div>' +
                    '<div style="color: var(--text-primary); font-weight: var(--font-weight-semibold);">(' + percentage + '%)</div>' +
                    '<div style="font-size: var(--font-size-xs); color: var(--text-muted); margin-top: var(--space-xs);">' + rangeText + '</div>';

                container.appendChild(shard);
            }

            logFinal('✅ MongoDB cluster updated - ' + mongoShardCount + ' shards active');
        }

        function updatePostgreSQLCommands() {
            var partitionCommands = "-- Current PostgreSQL partitioning setup\n";
            
            for (var i = 1; i <= sqlPartitionCount; i++) {
                var rangeStart = ((i - 1) * 10000) + 1;
                var rangeEnd = i * 10000;
                
                partitionCommands += "CREATE TABLE users_partition_" + i + " (\n";
                partitionCommands += "    user_id INTEGER NOT NULL,\n";
                partitionCommands += "    email VARCHAR(255),\n";
                partitionCommands += "    name VARCHAR(255),\n";
                partitionCommands += "    created_at TIMESTAMP,\n";
                partitionCommands += "    CHECK (user_id >= " + rangeStart + " AND user_id <= " + rangeEnd + ")\n";
                partitionCommands += ") INHERITS (users);\n\n";
                
                partitionCommands += "CREATE INDEX idx_users_partition_" + i + "_id ON users_partition_" + i + " (user_id);\n";
                partitionCommands += "CREATE INDEX idx_users_partition_" + i + "_email ON users_partition_" + i + " (email);\n\n";
            }
            
            partitionCommands += "-- Update trigger function for routing\n";
            partitionCommands += "CREATE OR REPLACE FUNCTION users_insert_trigger()\n";
            partitionCommands += "RETURNS TRIGGER AS $\n";
            partitionCommands += "BEGIN\n";
            
            for (var i = 1; i <= sqlPartitionCount; i++) {
                var rangeStart = ((i - 1) * 10000) + 1;
                var rangeEnd = i * 10000;
                var condition = i === 1 ? "IF" : "ELSIF";
                
                partitionCommands += "    " + condition + " NEW.user_id >= " + rangeStart + " AND NEW.user_id <= " + rangeEnd + " THEN\n";
                partitionCommands += "        INSERT INTO users_partition_" + i + " VALUES (NEW.*);\n";
            }
            
            partitionCommands += "    ELSE\n";
            partitionCommands += "        RAISE EXCEPTION 'user_id out of range';\n";
            partitionCommands += "    END IF;\n";
            partitionCommands += "    RETURN NULL;\n";
            partitionCommands += "END;\n";
            partitionCommands += "$ LANGUAGE plpgsql;\n\n";
            partitionCommands += "-- ⚠️ NO automatic data rebalancing!\n";
            partitionCommands += "-- ⚠️ Manual data migration required for even distribution\n";
            
            if (sqlPartitionCount > 1) {
                partitionCommands += "\n-- Optional manual rebalancing (ADDITIONAL DOWNTIME):\n";
                for (var i = 1; i < sqlPartitionCount; i++) {
                    partitionCommands += "-- BEGIN; -- Start transaction\n";
                    partitionCommands += "-- INSERT INTO users_partition_" + (i + 1) + " \n";
                    partitionCommands += "--   SELECT * FROM users_partition_" + i + " WHERE user_id > " + (i * 10000) + ";\n";
                    partitionCommands += "-- DELETE FROM users_partition_" + i + " WHERE user_id > " + (i * 10000) + ";\n";
                    partitionCommands += "-- COMMIT; -- Hours of downtime per migration\n\n";
                }
            }
            
            document.getElementById('postgresql-content').textContent = partitionCommands;
        }

        function addPostgresPartition() {
            sqlPartitionCount++;
            
            // Add new empty partition (PostgreSQL doesn't auto-rebalance!)
            while (sqlData.length < sqlPartitionCount) {
                sqlData.push(0);
            }
            
            // Simulate the complex partition creation process
            logFinal('🔧 DBA Command: Manual partition creation required', 'sql');
            logFinal('😨 SQL: SCHEDULED MAINTENANCE WINDOW - Taking application offline', 'sql');
            logFinal('⏱️ SQL: Estimated downtime: 2-4 hours for partition setup', 'sql');
            logFinal('📝 SQL: Creating partition table with CHECK constraints', 'sql');
            logFinal('🔧 SQL: Updating trigger functions for data routing', 'sql');
            logFinal('⚡ SQL: Creating indexes on new partition', 'sql');
            logFinal('🔄 SQL: Restarting application servers for new partition', 'sql');
            logFinal('⚠️ SQL: NO automatic rebalancing - existing data stays uneven!', 'sql');
            logFinal('✅ SQL: Partition ' + sqlPartitionCount + ' ready (empty)', 'sql');
            
            updateStatsFinal();
            renderSqlPartitionsFinal();
            updatePostgreSQLCommands();
            
            logFinal('📈 MongoDB equivalent: sh.addShard() - zero downtime, auto-rebalancing', 'command');
        }

        function renderSqlPartitionsFinal() {
            var container = document.getElementById('sqlContainer');
            container.innerHTML = '';

            for (var i = 1; i <= sqlPartitionCount; i++) {
                var partition = document.createElement('div');
                partition.className = 'shard sql';
                
                var records = sqlData[i - 1] || 0;
                var percentage = totalRecords > 0 ? Math.round((records / totalRecords) * 100) : 0;
                
                // Calculate range for display
                var rangeStart = ((i - 1) * 10000) + 1;
                var rangeEnd = i * 10000;
                var rangeText = 'user_id: ' + rangeStart + '-' + rangeEnd;
                
                // Show if partition is empty (common in PostgreSQL)
                var statusText = records === 0 ? '<div style="color: var(--error); font-weight: var(--font-weight-semibold); font-size: var(--font-size-xs); margin-top: var(--space-xs);">EMPTY - No auto-rebalance</div>' : '';

                partition.innerHTML = 
                    '<div class="shard-title sql">Partition ' + i + '</div>' +
                    '<div><strong>' + rangeText + '</strong></div>' +
                    '<div>' + records.toLocaleString() + ' records</div>' +
                    '<div style="color: var(--error); font-weight: var(--font-weight-semibold);">(' + percentage + '%)</div>' +
                    statusText;

                container.appendChild(partition);
            }
        }

        function addDataFinal() {
            totalRecords += 1000;

            // Determine if we need new SQL partitions based on realistic thresholds
            var partitionThreshold = 10000; // Records per partition capacity
            var requiredPartitions = Math.ceil(totalRecords / partitionThreshold);
            
            if (requiredPartitions > sqlPartitionCount) {
                // Add new partition(s) - this simulates the manual process
                var oldPartitionCount = sqlPartitionCount;
                sqlPartitionCount = requiredPartitions;
                
                // Add new empty partition arrays (PostgreSQL doesn't auto-rebalance!)
                while (sqlData.length < sqlPartitionCount) {
                    sqlData.push(0);
                }
                
                // Simulate the complex partition creation process
                logFinal('⚠️ SQL: CAPACITY THRESHOLD REACHED - New partition needed!', 'sql');
                logFinal('🚨 SQL: SCHEDULED MAINTENANCE WINDOW - Taking application offline', 'sql');
                logFinal('⏱️ SQL: Estimated downtime: 2-4 hours for partition setup', 'sql');
                logFinal('📝 SQL: Creating partition table with CHECK constraints', 'sql');
                logFinal('🔧 SQL: Updating trigger functions for data routing', 'sql');
                logFinal('⚡ SQL: Creating indexes on new partition', 'sql');
                logFinal('🔄 SQL: Restarting application servers for new partition', 'sql');
                logFinal('⚠️ SQL: NO automatic rebalancing - existing data stays uneven!', 'sql');
                logFinal('✅ SQL: Partition ' + sqlPartitionCount + ' ready (empty)', 'sql');
                
                // Update PostgreSQL commands tab to show current state
                updatePostgreSQLCommands();
            }

            // Add the new 1000 records - PostgreSQL routes by range, doesn't rebalance
            if (sqlPartitionCount === 1) {
                // Single partition - all data goes here
                sqlData[0] += 1000;
            } else {
                // PostgreSQL routes new data to appropriate partition by user_id range
                // Simulate user_id ranges: 1-10000, 10001-20000, 20001-30000, etc.
                var currentMaxUserId = totalRecords - 1000; // Before adding new records
                var newDataStart = currentMaxUserId + 1;
                var newDataEnd = totalRecords;
                
                // Determine which partition(s) the new data goes to
                for (var userId = newDataStart; userId <= newDataEnd; userId++) {
                    var targetPartition = Math.floor((userId - 1) / partitionThreshold);
                    if (targetPartition >= sqlPartitionCount) {
                        targetPartition = sqlPartitionCount - 1; // Fallback to last partition
                    }
                    sqlData[targetPartition]++;
                }
            }

            // Distribute across MongoDB shards (automatic)
            var perShard = Math.floor(1000 / mongoShardCount);
            var remainder = 1000 % mongoShardCount;

            for (var i = 1; i <= mongoShardCount; i++) {
                var additional = perShard + (i <= remainder ? 1 : 0);
                mongoData['shard' + i] = (mongoData['shard' + i] || 0) + additional;
            }

            updateStatsFinal();
            renderMongoShardsFinal();
            renderSqlPartitionsFinal();

            logFinal('📈 Added 1000 records (Total: ' + totalRecords.toLocaleString() + ')');
            logFinal('✅ MongoDB: Auto-distributed via mongos router', 'command');
            
            if (sqlPartitionCount > 1) {
                var unevenWarning = '';
                var maxRecords = Math.max(...sqlData);
                var minRecords = Math.min(...sqlData.slice(0, sqlPartitionCount));
                if (maxRecords - minRecords > 1000) {
                    unevenWarning = ' (UNEVEN - no auto-rebalancing!)';
                }
                logFinal('⚠️ SQL: Data routed to partition by user_id range' + unevenWarning, 'sql');
                
                // Show which partition got the new data
                var lastPartitionWithData = -1;
                for (var i = sqlPartitionCount - 1; i >= 0; i--) {
                    if (sqlData[i] > 0) {
                        lastPartitionWithData = i + 1;
                        break;
                    }
                }
                if (lastPartitionWithData > 0) {
                    logFinal('📊 SQL: New records added to partition ' + lastPartitionWithData, 'sql');
                }
            } else {
                logFinal('⚠️ SQL: All records in single partition - approaching capacity limit', 'sql');
            }
        }

        function addShardFinal() {
            mongoShardCount++;
            var newShardKey = 'shard' + mongoShardCount;
            mongoData[newShardKey] = 0;

            var locations = ['US-East', 'US-West', 'EU', 'Asia-Pacific', 'Canada', 'Australia', 'Brazil', 'India'];
            var newLocation = locations[mongoShardCount - 1] || 'Region-' + mongoShardCount;

            logFinal('🔧 DBA Command: sh.addShard("' + newLocation.toLowerCase() + ':27017")', 'command');
            logFinal('🎯 mongos discovering new shard and updating routing tables', 'command');

            // Automatic rebalancing
            var totalData = 0;
            for (var key in mongoData) {
                totalData += mongoData[key];
            }

            if (totalData > 0) {
                var targetPerShard = Math.floor(totalData / mongoShardCount);
                var remainder = totalData % mongoShardCount;

                // Redistribute data
                for (var i = 1; i <= mongoShardCount; i++) {
                    mongoData['shard' + i] = targetPerShard + (i <= remainder ? 1 : 0);
                }
            }

            updateStatsFinal();
            renderMongoShardsFinal();

            logFinal('⚖️ Automatic chunk migration started by balancer', 'command');
            logFinal('✅ Shard ' + mongoShardCount + ' (' + newLocation + ') integrated with zero downtime');
            logFinal('⚠️ SQL equivalent: Manual partition + app code changes + downtime', 'sql');

            // Remove highlighting after animation
            setTimeout(function() {
                var newShard = document.getElementById('mongoShard' + mongoShardCount);
                if (newShard) {
                    newShard.classList.remove('new-shard');
                    logFinal('🎯 Shard ' + mongoShardCount + ' balancing completed - production ready');
                }
            }, 3000);
        }

        function resetFinal() {
            totalRecords = 0;
            mongoShardCount = 3;
            sqlPartitionCount = 1;
            mongoData = { shard1: 0, shard2: 0, shard3: 0 };
            sqlData = [0];

            updateStatsFinal();
            renderMongoShardsFinal();
            renderSqlPartitionsFinal();
            
            document.getElementById('logContainer').innerHTML = '';

            logFinal('🔄 Demo reset to initial 3-shard configuration');
            logFinal('📊 MongoDB: Ready for horizontal scaling demonstration');
            logFinal('🗄️ SQL: Single partition, manual scaling required');
            logFinal('🚀 Try adding data and shards to see the difference!');
        }

        function toggleDemoOverview() {
            var overview = document.getElementById('demoOverview');
            var toggle = document.getElementById('demoToggle');
            
            if (overview.style.display === 'none') {
                overview.style.display = 'block';
                toggle.textContent = '▲';
            } else {
                overview.style.display = 'none';
                toggle.textContent = '▼';
            }
        }

        // Initialize everything when DOM is ready
        window.onload = function() {
            updatePostgreSQLCommands(); // Initialize PostgreSQL commands
            logFinal('🎉 MongoDB vs SQL horizontal scaling demo initialized');
            logFinal('🔧 MongoDB sharded cluster with mongos router active');
            logFinal('🗄️ SQL manual partitioning setup ready for comparison');
            renderMongoShardsFinal();
            renderSqlPartitionsFinal();
            updateStatsFinal();
            logFinal('✅ Demo ready - click buttons to see scaling in action!');
            console.log('MongoDB Horizontal Scaling Demo - Enhanced');
        };
    </script>
</body>
</html>