<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YCV5KGB8ES"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-YCV5KGB8ES');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Query Building - Aggregation Pipeline</title>
    <link rel="stylesheet" href="shared-theme.css">
    <style>
        body {
            background: var(--background);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-2xl) var(--space-lg);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: var(--font-size-4xl);
            margin-bottom: 15px;
            color: var(--primary-color);
            font-weight: var(--font-weight-bold);
        }

        .header p {
            font-size: var(--font-size-xl);
            color: var(--text-secondary);
            font-weight: var(--font-weight-normal);
        }

        .so-what-section {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: var(--space-2xl);
            margin: var(--space-xl) auto;
            max-width: 900px;
            box-shadow: 0 4px 12px var(--shadow-md);
            border: 1px solid var(--border);
        }

        .so-what-title {
            color: var(--primary-color);
            margin-bottom: var(--space-lg);
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .so-what-text {
            color: var(--text-secondary);
            font-size: var(--font-size-lg);
            line-height: var(--line-height-relaxed);
            margin-bottom: var(--space-lg);
        }

        .real-impact-box {
            background: rgba(0, 237, 100, 0.1);
            padding: var(--space-lg);
            border-radius: var(--radius);
            border-left: 4px solid var(--secondary-color);
            margin-top: var(--space-lg);
        }

        .real-impact-text {
            color: var(--primary-color);
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-lg);
        }

        .demo-overview-section {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin: var(--space-xl) auto;
            max-width: 900px;
            box-shadow: 0 4px 12px var(--shadow-md);
            border: 1px solid var(--border);
        }

        .demo-toggle-header {
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-md);
            transition: var(--transition);
        }

        .demo-toggle-header:hover {
            transform: translateY(-2px);
        }

        .demo-toggle-title {
            color: var(--primary-color);
            margin: 0;
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-semibold);
        }

        .demo-toggle-icon {
            color: var(--secondary-color);
            font-size: var(--font-size-xl);
            transition: var(--transition);
        }

        .demo-content {
            margin-top: var(--space-xl);
            padding-top: var(--space-xl);
            border-top: 2px solid var(--border);
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-xl);
            margin-bottom: var(--space-xl);
        }

        .scenario-card {
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 12px var(--shadow-md);
            border: 1px solid var(--border);
        }

        .mongo-scenario {
            background: rgba(0, 237, 100, 0.05);
            border-color: var(--secondary-color);
        }

        .sql-scenario {
            background: rgba(239, 68, 68, 0.05);
            border-color: var(--error);
        }

        .scenario-title {
            margin-bottom: var(--space-md);
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-xl);
        }

        .mongo-title {
            color: var(--primary-color);
        }

        .sql-title {
            color: var(--error);
        }

        .scenario-list {
            color: var(--text-secondary);
            line-height: var(--line-height-relaxed);
            margin: 0;
            padding-left: var(--space-lg);
        }

        .scenario-list li {
            margin-bottom: var(--space-sm);
        }

        .scenario-list strong {
            color: var(--primary-color);
        }

        .sql-scenario .scenario-list strong {
            color: var(--error);
        }

        .learning-points {
            background: var(--surface);
            padding: var(--space-xl);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
        }

        .learning-title {
            color: var(--primary-color);
            margin-bottom: var(--space-lg);
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-xl);
        }

        .points-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-lg);
        }

        .learning-point {
            padding: var(--space-md);
            background: var(--background-soft);
            border-radius: var(--radius);
            box-shadow: 0 2px 8px var(--shadow-sm);
            border-left: 3px solid var(--secondary-color);
        }

        .point-title {
            color: var(--primary-color);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-sm);
        }

        .point-description {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-2xl);
            margin-bottom: var(--space-3xl);
        }

        .side {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            box-shadow: 0 4px 12px var(--shadow-md);
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .side::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--secondary-color);
        }

        .side.relational::before {
            background: var(--error);
        }

        .side h2 {
            color: var(--primary-color);
            margin-bottom: var(--space-lg);
            font-size: var(--font-size-3xl);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            font-weight: var(--font-weight-semibold);
        }

        .side.relational h2 {
            color: var(--error);
        }

        .logo {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-inverse);
            font-weight: var(--font-weight-bold);
            font-size: var(--font-size-xl);
        }

        .logo.relational {
            background: var(--error);
        }

        .pipeline-section {
            margin-bottom: var(--space-2xl);
            padding: var(--space-lg);
            background: var(--background-soft);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--secondary-color);
        }

        .pipeline-section.relational {
            border-left-color: var(--error);
        }

        .pipeline-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            color: var(--primary-color);
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .pipeline-title.relational {
            color: var(--error);
        }

        .code-block {
            background: var(--primary-color);
            color: var(--text-inverse);
            padding: var(--space-md);
            border-radius: var(--radius);
            font-family: 'SF Mono', Monaco, monospace;
            font-size: var(--font-size-sm);
            margin: var(--space-md) 0;
            overflow-x: auto;
            position: relative;
        }

        .pipeline-step {
            background: rgba(0, 237, 100, 0.1);
            border: 2px solid var(--secondary-color);
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            margin: var(--space-md) 0;
            position: relative;
        }

        .pipeline-step.relational {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--error);
        }

        .step-number {
            position: absolute;
            top: -10px;
            left: var(--space-md);
            background: var(--secondary-color);
            color: var(--primary-color);
            width: 25px;
            height: 25px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-weight-bold);
            font-size: var(--font-size-sm);
        }

        .step-number.relational {
            background: var(--error);
            color: var(--text-inverse);
        }

        .step-title {
            font-weight: var(--font-weight-semibold);
            color: var(--primary-color);
            margin-bottom: var(--space-sm);
            margin-left: var(--space-lg);
        }

        .step-title.relational {
            color: var(--error);
        }

        .step-description {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            margin-left: var(--space-lg);
        }

        .simulation-container {
            background: var(--background-soft);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin: var(--space-lg) 0;
            border: 2px solid var(--border);
        }

        .simulation-controls {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
            flex-wrap: wrap;
        }

        .btn {
            padding: var(--space-md) var(--space-lg);
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: var(--font-weight-medium);
            transition: var(--transition);
            font-size: var(--font-size-sm);
        }

        .btn-primary {
            background: var(--secondary-color);
            color: var(--primary-color);
        }

        .btn-primary:hover {
            background: var(--secondary-hover);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--error);
            color: var(--text-inverse);
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--text-muted);
            color: var(--text-inverse);
        }

        .btn-secondary:hover {
            background: var(--text-secondary);
        }

        .query-selector {
            margin-bottom: var(--space-lg);
        }

        .query-selector select {
            padding: var(--space-md);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: var(--font-size-base);
            background: var(--surface);
            min-width: 200px;
            color: var(--text-primary);
        }

        .data-display {
            background: var(--primary-color);
            color: var(--text-inverse);
            padding: var(--space-md);
            border-radius: var(--radius);
            font-family: 'SF Mono', Monaco, monospace;
            font-size: var(--font-size-sm);
            min-height: 250px;
            overflow-y: auto;
            max-height: 500px;
            white-space: pre-wrap;
        }

        .results-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
            margin-top: var(--space-lg);
        }

        .result-section {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: 0 4px 12px var(--shadow-md);
            border: 1px solid var(--border);
        }

        .result-title {
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .result-title.mongo {
            color: var(--primary-color);
        }

        .result-title.sql {
            color: var(--error);
        }

        .pipeline-visual {
            display: flex;
            align-items: center;
            margin: var(--space-md) 0;
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .pipeline-box {
            background: var(--secondary-color);
            color: var(--primary-color);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius);
            font-size: var(--font-size-sm);
            text-align: center;
            min-width: 80px;
            font-weight: var(--font-weight-semibold);
        }

        .pipeline-arrow {
            color: var(--primary-color);
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
        }

        .complexity-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin: var(--space-md) 0;
            padding: var(--space-md);
            border-radius: var(--radius);
        }

        .complexity-indicator.low {
            background: rgba(0, 237, 100, 0.1);
            color: var(--success);
        }

        .complexity-indicator.high {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .log-entry {
            margin: var(--space-sm) 0;
            padding: var(--space-sm);
            border-left: 3px solid var(--secondary-color);
            background: rgba(0, 237, 100, 0.1);
            font-size: var(--font-size-sm);
        }

        .log-entry.sql {
            border-left-color: var(--error);
            background: rgba(239, 68, 68, 0.1);
        }

        .benefits {
            background: rgba(0, 237, 100, 0.1);
            padding: var(--space-md);
            border-radius: var(--radius);
            margin-top: var(--space-md);
        }

        .benefits.relational {
            background: rgba(239, 68, 68, 0.1);
        }

        .benefits h4 {
            color: var(--primary-color);
            margin-bottom: var(--space-md);
        }

        .benefits.relational h4 {
            color: var(--error);
        }

        .icon {
            display: inline-block;
            margin-right: var(--space-sm);
        }

        @media (max-width: 1024px) {
            .comparison {
                grid-template-columns: 1fr;
            }
            
            .scenario-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: var(--space-lg);
            }
            
            .header h1 {
                font-size: var(--font-size-3xl);
            }
            
            .results-container {
                grid-template-columns: 1fr;
            }
            
            .side {
                padding: var(--space-lg);
            }
            
            .simulation-controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .pipeline-visual {
                flex-direction: column;
                align-items: stretch;
            }
            
            .pipeline-arrow {
                transform: rotate(90deg);
                align-self: center;
            }
        }
    </style>
</head>
<body>
    <header class="unified-header">
        <div class="header-content">
            <a href="playground.html" class="header-logo">
                <div class="logo-icon">M</div>
                <span>MongoDB Playground</span>
            </a>
            <div class="breadcrumb">
                <a href="playground.html">Playground</a>
                <span class="breadcrumb-separator">></span>
                <span>Query Building</span>
            </div>
            <a href="playground.html" class="back-to-playground">‚Üê Back to Playground</a>
        </div>
    </header>

    <div class="container">
        <div class="header">
            <h1>Aggregation Pipeline vs Complex PostgreSQL Queries</h1>
            <p>Intuitive Data Processing vs Nested Query Complexity</p>
            
            <!-- So What Section -->
            <div class="so-what-section">
                <h2 class="so-what-title">üöÄ Why This Matters: Readable Code = Faster Development</h2>
                <p class="so-what-text">
                    Complex PostgreSQL queries with nested JOINs and subqueries can take hours to write, debug, and maintain. When business requirements change, updating these queries becomes a nightmare of trial and error. Enterprise teams often spend <strong>70% of their development time</strong> wrestling with PostgreSQL query optimization instead of building features.
                </p>
                <p class="so-what-text">
                    <strong>MongoDB's differentiator:</strong> Aggregation pipelines break complex data transformations into clear, sequential steps. Each stage is independently testable and easily understood. What takes 50 lines of complex PostgreSQL becomes 10 intuitive pipeline stages.
                </p>
                <div class="real-impact-box">
                    <div class="real-impact-text">
                        <strong>Real Impact:</strong> Teams reduce query development time by 80%, eliminate debugging headaches, and onboard new developers 3x faster with self-documenting pipeline code.
                    </div>
                </div>
            </div>

            <!-- Expandable Demo Overview -->
            <div class="demo-overview-section">
                <div class="demo-toggle-header" onclick="toggleDemoOverview()">
                    <h3 class="demo-toggle-title">üìã What This Demo Shows</h3>
                    <span id="demoToggle" class="demo-toggle-icon">‚ñº</span>
                </div>
                
                <div id="demoOverview" style="display: none;" class="demo-content">
                    <div class="scenario-grid">
                        <div class="scenario-card mongo-scenario">
                            <h4 class="scenario-title mongo-title">üçÉ MongoDB Pipeline Approach</h4>
                            <ul class="scenario-list">
                                <li>Sequential pipeline stages that build on each other</li>
                                <li>Each stage has a single, clear responsibility</li>
                                <li>Easy to test individual stages independently</li>
                                <li>Self-documenting with descriptive stage names</li>
                                <li><strong>Intuitive flow from raw data to insights</strong></li>
                            </ul>
                        </div>
                        
                        <div class="scenario-card sql-scenario">
                            <h4 class="scenario-title sql-title">üóÑÔ∏è Traditional SQL Approach</h4>
                            <ul class="scenario-list">
                                <li>Complex nested queries with multiple JOINs</li>
                                <li>All logic crammed into a single statement</li>
                                <li>Difficult to debug when something goes wrong</li>
                                <li>Requires deep SQL expertise to understand</li>
                                <li><strong>Monolithic queries that are hard to maintain</strong></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="learning-points">
                        <h4 class="learning-title">üéØ Key Learning Points</h4>
                        <div class="points-grid">
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Code Readability</div>
                                <div class="point-description">See how pipelines tell a clear data story</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Debugging Ease</div>
                                <div class="point-description">Test each stage independently vs. complex SQL</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Developer Experience</div>
                                <div class="point-description">Intuitive stages vs. nested query complexity</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Maintainability</div>
                                <div class="point-description">Easy modifications vs. rewriting entire queries</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sample Data Section -->
        <div style="background: var(--surface); border-radius: var(--radius-lg); padding: var(--space-xl); margin-bottom: var(--space-2xl); box-shadow: 0 4px 12px var(--shadow-md); border: 1px solid var(--border);">
            <h3 style="color: var(--primary-color); margin-bottom: var(--space-lg); text-align: center;">üìä Sample E-commerce Data</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg);">
                <div>
                    <h4 style="color: var(--primary-color); margin-bottom: var(--space-md);">MongoDB Collections</h4>
                    <div class="code-block">
// orders collection
{
  "_id": ObjectId("..."),
  "order_id": "ORD-001",
  "customer": {
    "name": "John Doe",
    "city": "San Francisco",
    "segment": "Premium"
  },
  "items": [
    {"product": "Laptop", "category": "Electronics", "price": 999, "qty": 1},
    {"product": "Mouse", "category": "Electronics", "price": 29, "qty": 2}
  ],
  "total": 1057,
  "order_date": "2024-03-15",
  "status": "shipped"
}
                    </div>
                </div>
                <div>
                    <h4 style="color: var(--error); margin-bottom: var(--space-md);">SQL Tables</h4>
                    <div class="code-block">
-- orders table
id | order_id | customer_id | total | order_date | status

-- customers table  
id | name | city | segment

-- order_items table
order_id | product | category | price | quantity
                    </div>
                </div>
            </div>
        </div>

        <div class="comparison">
            <!-- MongoDB Side -->
            <div class="side mongodb">
                <h2>
                    <div class="logo">M</div>
                    MongoDB Aggregation Pipeline
                </h2>

                <div class="pipeline-section">
                    <div class="pipeline-title">üîÑ Step-by-Step Data Processing</div>
                    
                    <div class="pipeline-step">
                        <div class="step-number">1</div>
                        <div class="step-title">$match - Filter Data</div>
                        <div class="step-description">Filter documents like WHERE clause</div>
                    </div>

                    <div class="pipeline-step">
                        <div class="step-number">2</div>
                        <div class="step-title">$unwind - Flatten Arrays</div>
                        <div class="step-description">Deconstruct array fields into separate documents</div>
                    </div>

                    <div class="pipeline-step">
                        <div class="step-number">3</div>
                        <div class="step-title">$group - Aggregate Data</div>
                        <div class="step-description">Group by fields and calculate aggregations</div>
                    </div>

                    <div class="pipeline-step">
                        <div class="step-number">4</div>
                        <div class="step-title">$sort - Order Results</div>
                        <div class="step-description">Sort the aggregated results</div>
                    </div>

                    <div class="pipeline-step">
                        <div class="step-number">5</div>
                        <div class="step-title">$project - Shape Output</div>
                        <div class="step-description">Select and format fields for final output</div>
                    </div>

                    <div class="complexity-indicator low">
                        <span>üìà Complexity Level: Low - Readable & Intuitive</span>
                    </div>
                </div>

                <div class="simulation-container">
                    <h4>üéÆ Interactive Pipeline Builder</h4>
                    <div class="query-selector">
                        <label for="mongoQuerySelect">Choose Analysis:</label>
                        <select id="mongoQuerySelect" onchange="updateMongoQuery()">
                            <option value="sales_by_category">Sales by Category</option>
                            <option value="top_customers">Top Customers by Revenue</option>
                            <option value="monthly_trends">Monthly Sales Trends</option>
                            <option value="city_analysis">Sales by City</option>
                        </select>
                    </div>
                    <div class="simulation-controls">
                        <button class="btn btn-primary" onclick="executeMongoQuery()">Run Pipeline</button>
                        <button class="btn btn-primary" onclick="stepThroughPipeline()">Step Through</button>
                        <button class="btn btn-secondary" onclick="mongoReset()">Reset</button>
                    </div>
                    
                    <div id="mongoPipelineVisual"></div>
                    <div class="data-display" id="mongoQuery"></div>
                    <div id="mongoLog"></div>
                </div>

                <div class="benefits">
                    <h4>‚úÖ Pipeline Benefits</h4>
                    <ul>
                        <li><span class="icon">üîÑ</span> Sequential, easy-to-follow steps</li>
                        <li><span class="icon">üß©</span> Composable and reusable stages</li>
                        <li><span class="icon">üéØ</span> Self-documenting data flow</li>
                        <li><span class="icon">‚ö°</span> Optimized execution planning</li>
                        <li><span class="icon">üîß</span> Rich set of operators and functions</li>
                    </ul>
                </div>
            </div>

            <!-- SQL Side -->
            <div class="side relational">
                <h2>
                    <div class="logo sql">P</div>
                    PostgreSQL: Complex JOIN Queries
                </h2>

                <div class="pipeline-section relational">
                    <div class="pipeline-title relational">üï∏Ô∏è Nested Query Structure</div>
                    
                    <div class="pipeline-step relational">
                        <div class="step-number relational">1</div>
                        <div class="step-title relational">FROM & JOINs - Combine Tables</div>
                        <div class="step-description">Multiple table joins to reconstruct data</div>
                    </div>

                    <div class="pipeline-step relational">
                        <div class="step-number relational">2</div>
                        <div class="step-title relational">WHERE - Apply Filters</div>
                        <div class="step-description">Complex filtering across joined tables</div>
                    </div>

                    <div class="pipeline-step relational">
                        <div class="step-number relational">3</div>
                        <div class="step-title relational">GROUP BY - Aggregate</div>
                        <div class="step-description">Group and aggregate with complex expressions</div>
                    </div>

                    <div class="pipeline-step relational">
                        <div class="step-number relational">4</div>
                        <div class="step-title relational">HAVING - Filter Groups</div>
                        <div class="step-description">Post-aggregation filtering</div>
                    </div>

                    <div class="pipeline-step relational">
                        <div class="step-number relational">5</div>
                        <div class="step-title relational">ORDER BY - Sort Results</div>
                        <div class="step-description">Final result ordering</div>
                    </div>

                    <div class="complexity-indicator high">
                        <span>üìà Complexity Level: High - Nested & Complex</span>
                    </div>
                </div>

                <div class="simulation-container">
                    <h4>üéÆ SQL Query Generator</h4>
                    <div class="query-selector">
                        <label for="sqlQuery">Choose Analysis:</label>
                        <select id="sqlQuery" onchange="updateSqlQuery()">
                            <option value="sales_by_category">Sales by Category</option>
                            <option value="top_customers">Top Customers by Revenue</option>
                            <option value="monthly_trends">Monthly Sales Trends</option>
                            <option value="city_analysis">Sales by City</option>
                        </select>
                    </div>
                    <div class="simulation-controls">
                        <button class="btn btn-danger" onclick="executeSqlQuery()">Execute SQL</button>
                        <button class="btn btn-danger" onclick="explainSqlQuery()">Explain Query</button>
                        <button class="btn btn-secondary" onclick="sqlReset()">Reset</button>
                    </div>
                    
                    <div class="data-display" id="sqlQueryDisplay"></div>
                    <div id="sqlLog"></div>
                </div>

                <div class="benefits relational">
                    <h4>‚ö†Ô∏è SQL Complexity</h4>
                    <ul>
                        <li><span class="icon">üï∏Ô∏è</span> Nested subqueries and CTEs</li>
                        <li><span class="icon">üîó</span> Complex multi-table JOINs</li>
                        <li><span class="icon">üß†</span> Requires deep SQL knowledge</li>
                        <li><span class="icon">üêõ</span> Harder to debug and maintain</li>
                        <li><span class="icon">‚ö°</span> Performance issues with complex joins</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Results Comparison -->
        <div class="results-container">
            <div class="result-section">
                <div class="result-title mongo">
                    <div class="logo">M</div>
                    MongoDB Pipeline Results
                </div>
                <div class="data-display" id="mongoResults"></div>
            </div>
            
            <div class="result-section">
                <div class="result-title sql">
                    <div class="logo relational">SQL</div>
                    SQL Query Results
                </div>
                <div class="data-display" id="sqlResults"></div>
            </div>
        </div>

        <!-- Summary Section -->
        <div style="background: var(--surface); border-radius: var(--radius-lg); padding: var(--space-2xl); box-shadow: 0 4px 12px var(--shadow-md); border: 1px solid var(--border); margin-top: var(--space-2xl);">
            <h2 style="text-align: center; color: var(--primary-color); margin-bottom: var(--space-2xl);">Key Differences: Pipeline vs SQL</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-2xl);">
                <div>
                    <h3 style="color: var(--primary-color); margin-bottom: var(--space-md);">üçÉ MongoDB Aggregation Pipeline</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin: var(--space-md) 0; padding: var(--space-md); background: rgba(0, 237, 100, 0.1); border-radius: var(--radius);">
                            <strong>Sequential Processing:</strong> Clear step-by-step data transformation
                        </li>
                        <li style="margin: var(--space-md) 0; padding: var(--space-md); background: rgba(0, 237, 100, 0.1); border-radius: var(--radius);">
                            <strong>Readable Syntax:</strong> Self-documenting pipeline stages
                        </li>
                        <li style="margin: var(--space-md) 0; padding: var(--space-md); background: rgba(0, 237, 100, 0.1); border-radius: var(--radius);">
                            <strong>Rich Operators:</strong> 100+ operators for complex transformations
                        </li>
                        <li style="margin: var(--space-md) 0; padding: var(--space-md); background: rgba(0, 237, 100, 0.1); border-radius: var(--radius);">
                            <strong>Easy Debugging:</strong> Test each stage independently
                        </li>
                    </ul>
                </div>
                
                <div>
                    <h3 style="color: var(--error); margin-bottom: var(--space-md);">üóÑÔ∏è Complex SQL Queries</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin: var(--space-md) 0; padding: var(--space-md); background: rgba(239, 68, 68, 0.1); border-radius: var(--radius);">
                            <strong>Nested Structure:</strong> Complex subqueries and CTEs
                        </li>
                        <li style="margin: var(--space-md) 0; padding: var(--space-md); background: rgba(239, 68, 68, 0.1); border-radius: var(--radius);">
                            <strong>JOIN Complexity:</strong> Multiple table relationships to manage
                        </li>
                        <li style="margin: var(--space-md) 0; padding: var(--space-md); background: rgba(239, 68, 68, 0.1); border-radius: var(--radius);">
                            <strong>Learning Curve:</strong> Requires advanced SQL knowledge
                        </li>
                        <li style="margin: var(--space-md) 0; padding: var(--space-md); background: rgba(239, 68, 68, 0.1); border-radius: var(--radius);">
                            <strong>Maintenance Issues:</strong> Difficult to modify and debug
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data
        const sampleOrders = [
            {
                _id: 1,
                order_id: "ORD-001",
                customer: {name: "John Doe", city: "San Francisco", segment: "Premium"},
                items: [
                    {product: "Laptop", category: "Electronics", price: 999, qty: 1},
                    {product: "Mouse", category: "Electronics", price: 29, qty: 2}
                ],
                total: 1057,
                order_date: "2024-03-15",
                status: "shipped"
            },
            {
                _id: 2,
                order_id: "ORD-002", 
                customer: {name: "Jane Smith", city: "New York", segment: "Standard"},
                items: [
                    {product: "Book", category: "Books", price: 25, qty: 3},
                    {product: "Pen", category: "Office", price: 5, qty: 10}
                ],
                total: 125,
                order_date: "2024-03-16",
                status: "delivered"
            },
            {
                _id: 3,
                order_id: "ORD-003",
                customer: {name: "Bob Wilson", city: "San Francisco", segment: "Premium"},
                items: [
                    {product: "Phone", category: "Electronics", price: 799, qty: 1},
                    {product: "Case", category: "Electronics", price: 39, qty: 1}
                ],
                total: 838,
                order_date: "2024-04-01",
                status: "shipped"
            }
        ];

        let currentPipelineStep = 0;
        let currentQuery = 'sales_by_category';

        // MongoDB Pipeline Queries
        const mongoPipelines = {
            sales_by_category: [
                {stage: "$unwind", description: "Flatten items array", code: '{"$unwind": "$items"}'},
                {stage: "$group", description: "Group by category and sum", code: '{"$group": {"_id": "$items.category", "total_sales": {"$sum": {"$multiply": ["$items.price", "$items.qty"]}}}}'},
                {stage: "$sort", description: "Sort by total sales descending", code: '{"$sort": {"total_sales": -1}}'},
                {stage: "$project", description: "Format output", code: '{"$project": {"category": "$_id", "total_sales": 1, "_id": 0}}'}
            ],
            top_customers: [
                {stage: "$group", description: "Group by customer and sum totals", code: '{"$group": {"_id": "$customer.name", "total_spent": {"$sum": "$total"}, "orders": {"$sum": 1}}}'},
                {stage: "$sort", description: "Sort by total spent descending", code: '{"$sort": {"total_spent": -1}}'},
                {stage: "$limit", description: "Get top 5 customers", code: '{"$limit": 5}'},
                {stage: "$project", description: "Format customer data", code: '{"$project": {"customer": "$_id", "total_spent": 1, "orders": 1, "_id": 0}}'}
            ],
            monthly_trends: [
                {stage: "$addFields", description: "Extract month from date", code: '{"$addFields": {"month": {"$dateToString": {"format": "%Y-%m", "date": {"$dateFromString": {"dateString": "$order_date"}}}}}}'},
                {stage: "$group", description: "Group by month and sum", code: '{"$group": {"_id": "$month", "total_sales": {"$sum": "$total"}, "order_count": {"$sum": 1}}}'},
                {stage: "$sort", description: "Sort by month", code: '{"$sort": {"_id": 1}}'},
                {stage: "$project", description: "Format monthly data", code: '{"$project": {"month": "$_id", "total_sales": 1, "order_count": 1, "_id": 0}}'}
            ],
            city_analysis: [
                {stage: "$group", description: "Group by city", code: '{"$group": {"_id": "$customer.city", "total_sales": {"$sum": "$total"}, "customers": {"$addToSet": "$customer.name"}}}'},
                {stage: "$addFields", description: "Count unique customers", code: '{"$addFields": {"customer_count": {"$size": "$customers"}}}'},
                {stage: "$project", description: "Format city data", code: '{"$project": {"city": "$_id", "total_sales": 1, "customer_count": 1, "_id": 0}}'},
                {stage: "$sort", description: "Sort by total sales", code: '{"$sort": {"total_sales": -1}}'}
            ]
        };

        // SQL Queries
        const sqlQueries = {
            sales_by_category: `
SELECT 
    oi.category,
    SUM(oi.price * oi.quantity) as total_sales
FROM orders o
JOIN order_items oi ON o.id = oi.order_id
GROUP BY oi.category
ORDER BY total_sales DESC;`,

            top_customers: `
SELECT 
    c.name as customer,
    SUM(o.total) as total_spent,
    COUNT(o.id) as orders
FROM customers c
JOIN orders o ON c.id = o.customer_id
GROUP BY c.id, c.name
ORDER BY total_spent DESC
LIMIT 5;`,

            monthly_trends: `
SELECT 
    DATE_FORMAT(o.order_date, '%Y-%m') as month,
    SUM(o.total) as total_sales,
    COUNT(o.id) as order_count
FROM orders o
GROUP BY DATE_FORMAT(o.order_date, '%Y-%m')
ORDER BY month;`,

            city_analysis: `
SELECT 
    c.city,
    SUM(o.total) as total_sales,
    COUNT(DISTINCT c.id) as customer_count
FROM customers c
JOIN orders o ON c.id = o.customer_id
GROUP BY c.city
ORDER BY total_sales DESC;`
        };

        // Initialize
        function init() {
            updateMongoQuery();
            updateSqlQuery();
            mongoReset();
            sqlReset();
        }

        // MongoDB Functions
        function updateMongoQuery() {
            currentQuery = document.getElementById('mongoQuerySelect').value;
            currentPipelineStep = 0;
            displayMongoPipeline();
        }

        function displayMongoPipeline() {
            const pipeline = mongoPipelines[currentQuery];
            const queryDisplay = document.getElementById('mongoQuery');
            
            let pipelineText = `// MongoDB Aggregation Pipeline: ${currentQuery.replace('_', ' ')}\n`;
            pipelineText += `db.orders.aggregate([\n`;
            
            pipeline.forEach((step, index) => {
                pipelineText += `  // Step ${index + 1}: ${step.description}\n`;
                pipelineText += `  ${step.code}${index < pipeline.length - 1 ? ',' : ''}\n\n`;
            });
            
            pipelineText += `])`;
            queryDisplay.textContent = pipelineText;
            
            // Update visual pipeline
            updatePipelineVisual(pipeline);
        }

        function updatePipelineVisual(pipeline) {
            const visual = document.getElementById('mongoPipelineVisual');
            visual.innerHTML = '<div style="font-weight: bold; margin-bottom: 10px;">Pipeline Flow:</div>';
            
            const flowDiv = document.createElement('div');
            flowDiv.className = 'pipeline-visual';
            
            pipeline.forEach((step, index) => {
                const box = document.createElement('div');
                box.className = 'pipeline-box';
                box.textContent = step.stage;
                flowDiv.appendChild(box);
                
                if (index < pipeline.length - 1) {
                    const arrow = document.createElement('div');
                    arrow.className = 'pipeline-arrow';
                    arrow.textContent = '‚Üí';
                    flowDiv.appendChild(arrow);
                }
            });
            
            visual.appendChild(flowDiv);
        }

        function executeMongoQuery() {
            const pipeline = mongoPipelines[currentQuery];
            mongoLog(`üöÄ Executing aggregation pipeline for ${currentQuery.replace('_', ' ')}`);
            
            // Simulate pipeline execution
            let results = [];
            
            switch(currentQuery) {
                case 'sales_by_category':
                    results = [
                        {category: "Electronics", total_sales: 1866},
                        {category: "Books", total_sales: 75},
                        {category: "Office", total_sales: 50}
                    ];
                    break;
                case 'top_customers':
                    results = [
                        {customer: "John Doe", total_spent: 1057, orders: 1},
                        {customer: "Bob Wilson", total_spent: 838, orders: 1},
                        {customer: "Jane Smith", total_spent: 125, orders: 1}
                    ];
                    break;
                case 'monthly_trends':
                    results = [
                        {month: "2024-03", total_sales: 1182, order_count: 2},
                        {month: "2024-04", total_sales: 838, order_count: 1}
                    ];
                    break;
                case 'city_analysis':
                    results = [
                        {city: "San Francisco", total_sales: 1895, customer_count: 2},
                        {city: "New York", total_sales: 125, customer_count: 1}
                    ];
                    break;
            }
            
            document.getElementById('mongoResults').textContent = JSON.stringify(results, null, 2);
            
            pipeline.forEach((step, index) => {
                setTimeout(() => {
                    mongoLog(`‚úÖ Step ${index + 1}: ${step.stage} - ${step.description}`);
                }, index * 500);
            });
            
            setTimeout(() => {
                mongoLog(`üéØ Pipeline completed! ${results.length} results returned`);
            }, pipeline.length * 500);
        }

        function stepThroughPipeline() {
            const pipeline = mongoPipelines[currentQuery];
            
            if (currentPipelineStep >= pipeline.length) {
                mongoLog('‚úÖ Pipeline completed! Click "Run Pipeline" to see final results');
                currentPipelineStep = 0;
                return;
            }
            
            const step = pipeline[currentPipelineStep];
            mongoLog(`üìç Step ${currentPipelineStep + 1}: ${step.stage} - ${step.description}`);
            mongoLog(`   Code: ${step.code}`);
            
            currentPipelineStep++;
            
            if (currentPipelineStep >= pipeline.length) {
                mongoLog('üèÅ All steps completed! Click "Run Pipeline" for results');
            }
        }

        function mongoReset() {
            currentPipelineStep = 0;
            document.getElementById('mongoResults').textContent = 'Click "Run Pipeline" to see results';
            document.getElementById('mongoLog').innerHTML = '';
            mongoLog('üîÑ MongoDB pipeline reset');
            displayMongoPipeline();
        }

        function mongoLog(message) {
            const log = document.getElementById('mongoLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // SQL Functions
        function updateSqlQuery() {
            const selectedQuery = document.getElementById('sqlQuery').value;
            const queryDisplay = document.getElementById('sqlQueryDisplay');
            const query = sqlQueries[selectedQuery];
            
            queryDisplay.textContent = `-- SQL Query: ${selectedQuery.replace('_', ' ')}\n${query}`;
        }

        function executeSqlQuery() {
            const selectedQuery = document.getElementById('sqlQuery').value;
            sqlLog(`üöÄ Executing SQL query for ${selectedQuery.replace('_', ' ')}`);
            sqlLog(`üîó Performing table JOINs...`);
            
            // Simulate SQL execution
            let results = [];
            
            switch(selectedQuery) {
                case 'sales_by_category':
                    results = [
                        ["Electronics", 1866],
                        ["Books", 75],
                        ["Office", 50]
                    ];
                    break;
                case 'top_customers':
                    results = [
                        ["John Doe", 1057, 1],
                        ["Bob Wilson", 838, 1],
                        ["Jane Smith", 125, 1]
                    ];
                    break;
                case 'monthly_trends':
                    results = [
                        ["2024-03", 1182, 2],
                        ["2024-04", 838, 1]
                    ];
                    break;
                case 'city_analysis':
                    results = [
                        ["San Francisco", 1895, 2],
                        ["New York", 125, 1]
                    ];
                    break;
            }
            
            // Format results as table
            let resultText = "Results:\n";
            results.forEach(row => {
                resultText += row.join(" | ") + "\n";
            });
            
            document.getElementById('sqlResults').textContent = resultText;
            
            setTimeout(() => {
                sqlLog(`‚ö†Ô∏è Query executed with multiple table JOINs`);
                sqlLog(`üìä ${results.length} rows returned`);
                sqlLog(`üîÑ Result set processed and formatted`);
            }, 1000);
        }

        function explainSqlQuery() {
            const selectedQuery = document.getElementById('sqlQuery').value;
            sqlLog(`üîç Explaining SQL query execution plan...`);
            
            setTimeout(() => {
                sqlLog(`üìã Query involves ${selectedQuery === 'top_customers' || selectedQuery === 'city_analysis' ? '2-3' : '2'} table JOINs`);
                sqlLog(`üîó JOIN operations require index lookups`);
                sqlLog(`üìä GROUP BY requires sorting and aggregation`);
                sqlLog(`‚ö†Ô∏è Complex nested structure increases execution time`);
            }, 500);
        }

        function sqlReset() {
            document.getElementById('sqlResults').textContent = 'Click "Execute SQL" to see results';
            document.getElementById('sqlLog').innerHTML = '';
            sqlLog('üîÑ SQL query reset');
        }

        function sqlLog(message) {
            const log = document.getElementById('sqlLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry sql';
            entry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // Navigation Functions - removed old accordion and mobile menu functions

        // Toggle demo overview section
        function toggleDemoOverview() {
            var overview = document.getElementById('demoOverview');
            var toggle = document.getElementById('demoToggle');
            
            if (overview.style.display === 'none') {
                overview.style.display = 'block';
                toggle.textContent = '‚ñ≤';
                toggle.style.transform = 'rotate(180deg)';
            } else {
                overview.style.display = 'none';
                toggle.textContent = '‚ñº';
                toggle.style.transform = 'rotate(0deg)';
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            init();
        });
    </script>
</body>
</html>
