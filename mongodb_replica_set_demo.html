<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YCV5KGB8ES"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-YCV5KGB8ES');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Replica Set High Availability</title>
    <link rel="stylesheet" href="shared-theme.css">
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--background);
        }

        /* Page-specific styles for replica set demo */

        .nav-menu.open {
            left: 0;
        }

        .nav-menu h2 {
            color: #00684A;
            margin-bottom: 30px;
            font-size: 1.6rem;
            font-weight: 700;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 3px solid #00ED64;
            background: linear-gradient(135deg, #00ED64 0%, #00B84D 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
        }

        .nav-menu h2::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #00ED64, #00B84D);
            border-radius: 2px;
        }

        .nav-menu ul {
            list-style: none;
        }

        .nav-menu li {
            margin-bottom: 8px;
        }

        .nav-menu > ul > li > a {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            text-decoration: none;
            color: #001E2B;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 4px solid transparent;
            font-weight: 600;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }

        .nav-menu > ul > li > a::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.1) 0%, rgba(0, 184, 77, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-menu > ul > li > a:hover::before,
        .nav-menu > ul > li > a.active::before {
            opacity: 1;
        }

        .nav-menu > ul > li > a:hover,
        .nav-menu > ul > li > a.active {
            border-left: 4px solid #00ED64;
            transform: translateX(8px);
            color: #00684A;
            box-shadow: 0 8px 25px rgba(0, 237, 100, 0.2);
        }

        /* Accordion Styles */
        .nav-accordion {
            margin-bottom: 10px;
        }

        .nav-category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 20px;
            background: linear-gradient(135deg, rgba(0, 104, 74, 0.1) 0%, rgba(0, 30, 43, 0.05) 100%);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 700;
            color: #00684A;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid rgba(0, 104, 74, 0.15);
            position: relative;
            overflow: hidden;
        }

        .nav-category-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.15) 0%, rgba(0, 184, 77, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-category-header:hover::before {
            opacity: 1;
        }

        .nav-category-header:hover {
            transform: translateX(6px);
            box-shadow: 0 4px 15px rgba(0, 104, 74, 0.2);
        }

        .accordion-icon {
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.9rem;
            color: #00684A;
            z-index: 1;
            position: relative;
        }

        .accordion-icon.rotated {
            transform: rotate(180deg);
        }

        .nav-accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-accordion-content.expanded {
            max-height: 400px;
        }

        .nav-accordion-content li {
            margin-bottom: 6px;
            margin-left: 20px;
            opacity: 0;
            transform: translateX(-20px);
            animation: slideInLeft 0.3s ease forwards;
        }

        .nav-accordion-content.expanded li:nth-child(1) { animation-delay: 0.1s; }
        .nav-accordion-content.expanded li:nth-child(2) { animation-delay: 0.2s; }
        .nav-accordion-content.expanded li:nth-child(3) { animation-delay: 0.3s; }
        .nav-accordion-content.expanded li:nth-child(4) { animation-delay: 0.4s; }
        .nav-accordion-content.expanded li:nth-child(5) { animation-delay: 0.5s; }

        @keyframes slideInLeft {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .nav-accordion-content a {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            text-decoration: none;
            color: #001E2B;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 3px solid transparent;
            font-weight: 500;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .nav-accordion-content a::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.1) 0%, rgba(0, 184, 77, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-accordion-content a:hover::before,
        .nav-accordion-content a.active::before {
            opacity: 1;
        }

        .nav-accordion-content a:hover,
        .nav-accordion-content a.active {
            border-left: 3px solid #00ED64;
            transform: translateX(8px);
            color: #00684A;
            box-shadow: 0 4px 15px rgba(0, 237, 100, 0.2);
        }

        /* Menu Toggle Button */
        .menu-toggle {
            position: fixed;
            top: 25px;
            left: 25px;
            z-index: 1001;
            background: rgba(0, 104, 74, 0.95);
            border: none;
            color: white;
            padding: 14px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.3rem;
            box-shadow: 0 6px 20px rgba(0, 30, 43, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .menu-toggle:hover {
            background: #00ED64;
            color: #001E2B;
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 8px 30px rgba(0, 237, 100, 0.4);
        }

        .menu-toggle.menu-open {
            background: #00ED64;
            color: #001E2B;
            transform: rotate(90deg);
        }

        /* Backdrop */
        .nav-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 30, 43, 0.8);
            backdrop-filter: blur(5px);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-backdrop.active {
            opacity: 1;
            visibility: visible;
        }

        /* Main Content Container */
        .container {
            padding: var(--space-lg);
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            font-weight: 700;
            background: linear-gradient(45deg, #00ED64, #00B84D);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
        }

        .header p {
            font-size: 1.3em;
            opacity: 0.9;
            font-weight: 400;
        }

        .so-what-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin: 25px auto;
            max-width: 900px;
            box-shadow: 0 8px 32px rgba(0, 30, 43, 0.15);
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .so-what-title {
            color: #00684A;
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .so-what-text {
            color: #001E2B;
            font-size: 1.1em;
            line-height: 1.7;
            margin-bottom: 20px;
            font-weight: 400;
        }

        .real-impact-box {
            background: linear-gradient(135deg, #E8F5E8 0%, #F0FFF0 100%);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #00ED64;
            margin-top: 20px;
        }

        .real-impact-text {
            color: #001E2B;
            font-weight: 600;
            font-size: 1.05em;
        }

        .demo-overview-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 25px;
            margin: 25px auto;
            max-width: 900px;
            box-shadow: 0 8px 32px rgba(0, 30, 43, 0.15);
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .demo-toggle-header {
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .demo-toggle-header:hover {
            transform: translateY(-2px);
        }

        .demo-toggle-title {
            color: #001E2B;
            margin: 0;
            font-size: 1.4em;
            font-weight: 600;
        }

        .demo-toggle-icon {
            color: #00684A;
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .demo-content {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #E8F5E8;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .scenario-card {
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 30, 43, 0.1);
        }

        .mongo-scenario {
            background: linear-gradient(135deg, #E8F5E8 0%, #F0FFF0 100%);
            border: 1px solid #00ED64;
        }

        .traditional-scenario {
            background: linear-gradient(135deg, #FDE8E8 0%, #FFF0F0 100%);
            border: 1px solid #FF6B6B;
        }

        .scenario-title {
            margin-bottom: 15px;
            font-weight: 600;
            font-size: 1.2em;
        }

        .mongo-title {
            color: #00684A;
        }

        .traditional-title {
            color: #D32F2F;
        }

        .scenario-list {
            color: #001E2B;
            line-height: 1.7;
            margin: 0;
            padding-left: 20px;
        }

        .scenario-list li {
            margin-bottom: 8px;
        }

        .scenario-list strong {
            color: #00684A;
        }

        .traditional-scenario .scenario-list strong {
            color: #D32F2F;
        }

        .learning-points {
            background: linear-gradient(135deg, #F8F9FA 0%, #FFFFFF 100%);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #E8F5E8;
        }

        .learning-title {
            color: #001E2B;
            margin-bottom: 20px;
            font-weight: 600;
            font-size: 1.2em;
        }

        .points-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .learning-point {
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 30, 43, 0.05);
            border-left: 3px solid #00ED64;
        }

        .point-title {
            color: #00684A;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .point-description {
            color: #001E2B;
            font-size: 0.95em;
            opacity: 0.8;
        }

        /* Technical Section Styles */
        .technical-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            box-shadow: 0 4px 12px var(--shadow-md);
        }

        .section-title {
            color: var(--primary-color);
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-lg);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: var(--space-sm);
        }

        .priority-explanation, .postgresql-comparison {
            margin-top: var(--space-lg);
            color: #001E2B;
        }

        .priority-config-box {
            background: var(--background-soft);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: var(--space-lg);
            margin-top: var(--space-md);
            color: #001E2B;
        }

        .config-scenarios {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-lg);
            margin: var(--space-lg) 0;
        }

        .scenario-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: var(--space-lg);
            box-shadow: 0 2px 6px var(--shadow-sm);
            color: #001E2B;
        }

        .scenario-card.mongodb-priority {
            border-left: 4px solid var(--primary-color);
        }

        .scenario-card.postgresql-wal {
            border-left: 4px solid var(--accent-orange);
        }

        .scenario-card.mongodb-advantage {
            border-left: 4px solid var(--secondary-color);
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.05) 0%, rgba(0, 184, 77, 0.02) 100%);
        }

        .node-config {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: var(--space-md) 0;
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .config-node {
            padding: var(--space-md);
            border-radius: var(--radius);
            text-align: center;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            min-width: 100px;
        }

        .config-node.primary-node {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: white;
        }

        .config-node.secondary-node {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--secondary-hover) 100%);
            color: #001E2B;
        }


        .priority-benefits {
            list-style: none;
            padding: 0;
            margin: var(--space-md) 0;
        }

        .priority-benefits li {
            background: var(--surface);
            border: 1px solid var(--border);
            border-left: 3px solid var(--secondary-color);
            padding: var(--space-md);
            margin-bottom: var(--space-sm);
            border-radius: var(--radius);
            color: #001E2B;
        }

        .two-node-scenario {
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid var(--accent-orange);
            border-left: 4px solid var(--accent-orange);
            border-radius: var(--radius);
            padding: var(--space-lg);
            margin-top: var(--space-lg);
            color: #001E2B;
        }

        .wal-scenarios {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-xl);
            margin-top: var(--space-lg);
        }

        .wal-architecture, .mongodb-flow {
            background: var(--background-soft);
            border-radius: var(--radius);
            padding: var(--space-lg);
            margin: var(--space-md) 0;
        }

        .wal-flow, .auto-process {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .wal-node, .auto-step {
            background: var(--surface);
            border: 2px solid var(--accent-blue);
            padding: var(--space-md);
            border-radius: var(--radius);
            text-align: center;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            min-width: 120px;
        }

        .auto-step {
            border-color: var(--secondary-color);
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.1) 0%, rgba(0, 184, 77, 0.05) 100%);
        }

        .wal-node.primary-wal {
            border-color: var(--accent-orange);
        }

        .wal-arrow, .auto-arrow {
            font-size: var(--font-size-lg);
            font-weight: bold;
            color: var(--text-secondary);
        }

        .failure-steps {
            margin-top: var(--space-md);
        }

        .step {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: var(--space-md);
            margin-bottom: var(--space-md);
            color: #001E2B;
        }

        .step p {
            margin: var(--space-xs) 0;
            font-size: var(--font-size-sm);
            color: #001E2B;
        }

        .wal-limitations ul, .mongodb-benefits ul {
            list-style: none;
            padding: 0;
            margin: var(--space-md) 0;
        }

        .wal-limitations li, .mongodb-benefits li {
            padding: var(--space-sm) var(--space-md);
            margin-bottom: var(--space-xs);
            border-radius: var(--radius);
            font-size: var(--font-size-sm);
            color: #001E2B;
        }

        .wal-limitations li {
            background: rgba(255, 152, 0, 0.1);
            border-left: 3px solid var(--accent-orange);
        }

        .mongodb-benefits li {
            background: rgba(0, 237, 100, 0.1);
            border-left: 3px solid var(--secondary-color);
        }

        .reality-comparison {
            margin-top: var(--space-xl);
        }

        .impact-table table {
            width: 100%;
            border-collapse: collapse;
            background: var(--surface);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 2px 6px var(--shadow-sm);
        }

        .impact-table th, .impact-table td {
            padding: var(--space-md);
            text-align: left;
            border-bottom: 1px solid var(--border);
            color: #001E2B;
        }

        .impact-table th {
            background: var(--background-soft);
            font-weight: var(--font-weight-semibold);
            color: #001E2B;
        }

        .impact-table td.advantage {
            color: var(--primary-color);
            font-weight: var(--font-weight-semibold);
        }

        .impact-table td.disadvantage {
            color: var(--accent-orange);
            font-weight: var(--font-weight-semibold);
        }

        /* Responsive Design for Technical Sections */
        @media (max-width: 768px) {
            .wal-scenarios {
                grid-template-columns: 1fr;
            }
            
            .config-scenarios {
                grid-template-columns: 1fr;
            }
            
            .node-config, .wal-flow, .auto-process {
                flex-direction: column;
            }
            
            .wal-arrow, .auto-arrow {
                transform: rotate(90deg);
            }
        }

        .controls {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 30, 43, 0.15);
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .controls h3 {
            color: #00684A;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 600;
        }

        .btn {
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00ED64, #00B84D);
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #00B84D, #00684A);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 237, 100, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #FF6B6B, #D32F2F);
        }

        .btn-danger:hover:not(:disabled) {
            background: linear-gradient(135deg, #D32F2F, #B71C1C);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 30, 43, 0.15);
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .stat-number {
            font-size: 2.2em;
            font-weight: 700;
            color: #00684A;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #001E2B;
            font-weight: 500;
            opacity: 0.8;
        }

        .architecture-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 30, 43, 0.15);
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .architecture-section h3 {
            color: #00684A;
            margin-bottom: 25px;
            font-size: 1.6em;
            font-weight: 600;
            text-align: center;
        }

        .replica-set-container {
            background: linear-gradient(135deg, #F8FFF8 0%, #F0FFF0 100%);
            border: 2px solid #00ED64;
            border-radius: 15px;
            padding: 30px;
            position: relative;
            min-height: 300px;
        }

        .replica-set-title {
            position: absolute;
            top: -15px;
            left: 20px;
            background: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            color: #00684A;
            border: 2px solid #00ED64;
        }

        .replica-members {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .replica-member {
            background: white;
            border: 3px solid #00ED64;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            min-width: 180px;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 30, 43, 0.1);
        }

        .replica-member:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 30, 43, 0.15);
        }

        .replica-member.primary {
            border-color: #00ED64;
            background: linear-gradient(135deg, #E8F5E8 0%, #F0FFF0 100%);
        }

        .replica-member.secondary {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #F8F9FA 0%, #FFFFFF 100%);
        }

        .replica-member.down {
            border-color: #FF6B6B;
            background: linear-gradient(135deg, #FDE8E8 0%, #FFF0F0 100%);
            opacity: 0.7;
        }

        .replica-member.recovering {
            border-color: #FFC107;
            background: linear-gradient(135deg, #FFF8E1 0%, #FFFACD 100%);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
            100% { opacity: 1; transform: scale(1); }
        }

        .member-role {
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 8px;
            color: white;
        }

        .member-role.primary {
            background: linear-gradient(135deg, #00ED64, #00B84D);
        }

        .member-role.secondary {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }

        .member-role.down {
            background: linear-gradient(135deg, #FF6B6B, #D32F2F);
        }

        .member-role.recovering {
            background: linear-gradient(135deg, #FFC107, #FF8F00);
        }

        .member-details {
            font-size: 0.9em;
            color: #001E2B;
        }

        .member-status {
            margin: 5px 0;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .status-healthy {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .status-down {
            background: #FDE8E8;
            color: #D32F2F;
        }

        .status-syncing {
            background: #FFF8E1;
            color: #F57C00;
        }

        .replication-flow {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ED64, transparent);
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .replication-flow.active {
            opacity: 1;
            animation: flow 2s infinite;
        }

        @keyframes flow {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .read-preferences {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 30, 43, 0.15);
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .read-preferences h3 {
            color: #00684A;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 600;
        }

        .read-option {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            background: #F8F9FA;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .read-option:hover {
            border-color: #00ED64;
            background: #F0FFF0;
        }

        .read-option.active {
            border-color: #00ED64;
            background: linear-gradient(135deg, #E8F5E8 0%, #F0FFF0 100%);
        }

        .read-option input[type="radio"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #00ED64;
            border-radius: 50%;
            position: relative;
        }

        .read-option input[type="radio"]:checked::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: #00ED64;
            border-radius: 50%;
        }

        .log-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 30, 43, 0.15);
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .log-container h3 {
            color: #00684A;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 600;
        }

        .log-content {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 0.9em;
        }

        .log-entry {
            margin: 5px 0;
            padding: 8px;
            border-left: 3px solid #00ED64;
            background: rgba(0, 237, 100, 0.1);
            border-radius: 0 6px 6px 0;
        }

        .log-entry.warning {
            border-left-color: #FFC107;
            background: rgba(255, 193, 7, 0.1);
        }

        .log-entry.error {
            border-left-color: #FF6B6B;
            background: rgba(255, 107, 107, 0.1);
        }

        .log-entry.success {
            border-left-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .container {
                padding: var(--space-md);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: var(--space-md);
            }
            
            .header h1 {
                font-size: 2em;
            }

            .scenario-grid {
                grid-template-columns: 1fr;
            }
            
            .replica-members {
                flex-direction: column;
            }
            
            .controls, .architecture-section {
                padding: 20px;
            }

            .btn {
                margin: 3px;
                padding: 10px 16px;
                font-size: 13px;
            }

            .points-grid {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .replica-member {
                min-width: 90%;
                margin-bottom: 10px;
            }

            .menu-toggle {
                top: 20px;
                left: 20px;
                padding: 12px;
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: var(--space-md);
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .controls {
                padding: 15px;
            }

            .btn {
                width: 100%;
                margin: 5px 0;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .replica-member {
                padding: 15px;
                min-width: 100%;
            }

            .nav-menu {
                width: 280px;
                left: -280px;
            }
        }

        /* Focus Styles for Accessibility */
        button:focus,
        a:focus {
            outline: 3px solid #00ED64;
            outline-offset: 2px;
        }

        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            .controls,
            .architecture-section,
            .read-preferences,
            .log-container {
                border: 2px solid #000;
            }
            
            .btn {
                border: 2px solid #000;
            }
        }

        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <header class="unified-header">
        <div class="header-content">
            <a href="playground.html" class="header-logo">
                <div class="logo-icon">M</div>
                <span>MongoDB Playground</span>
            </a>
            <nav class="header-nav">
                <a href="playground.html" class="back-to-playground">‚Üê Back to Playground</a>
            </nav>
        </div>
    </header>

    <div class="page-container">
        <nav class="breadcrumb" aria-label="Breadcrumb">
            <a href="playground.html">Playground</a>
            <span class="breadcrumb-separator">></span>
            <span>High Availability</span>
        </nav>
        
        <div class="container">
        <div class="header">
            <h1>üîÑ MongoDB Replica Set High Availability</h1>
            <p>Interactive Demo: Automatic Failover & Data Protection</p>
            
            <!-- So What Section -->
            <div class="so-what-section">
                <h2 class="so-what-title">üõ°Ô∏è Why This Matters: The Zero-Downtime Promise</h2>
                <p class="so-what-text">
                    Traditional databases often require complex clustering solutions, expensive third-party tools, or manual failover procedures that can take <strong>minutes or hours</strong> to restore service during failures. During this time, your application is completely unavailable.
                </p>
                <p class="so-what-text">
                    <strong>MongoDB's differentiator:</strong> Built-in replica sets provide automatic failover in <strong>seconds</strong>, continuous data protection, and transparent read scaling. No additional clustering software, no manual intervention, no single points of failure.
                </p>
                <div class="real-impact-box">
                    <div class="real-impact-text">
                        <strong>Real Impact:</strong> Applications achieve 99.99%+ uptime with automatic recovery, eliminate data loss risks, and scale read operations across multiple servers without architectural changes.
                    </div>
                </div>
            </div>

            <!-- Expandable Demo Overview -->
            <div class="demo-overview-section">
                <div class="demo-toggle-header" onclick="toggleDemoOverview()">
                    <h3 class="demo-toggle-title">üìã What This Demo Shows</h3>
                    <span id="demoToggle" class="demo-toggle-icon">‚ñº</span>
                </div>
                
                <div id="demoOverview" style="display: none;" class="demo-content">
                    <div class="scenario-grid">
                        <div class="scenario-card mongo-scenario">
                            <h4 class="scenario-title mongo-title">üçÉ MongoDB Replica Set</h4>
                            <ul class="scenario-list">
                                <li>MongoDB replica set with Primary/Secondary roles and automatic elections</li>
                                <li>Real-time data replication via oplog</li>
                                <li>Intelligent leader election (<strong>majority voting required</strong>)</li>
                                <li>Read scaling across secondary members</li>
                                <li><strong>Retryable writes and reads</strong> for automatic resilience</li>
                                <li><strong>Sub-10 second failover with zero data loss</strong></li>
                                <li><strong>Prevents split-brain with majority consensus</strong></li>
                            </ul>
                        </div>
                        
                        <div class="scenario-card traditional-scenario">
                            <h4 class="scenario-title traditional-title">üóÑÔ∏è Traditional Database Clustering</h4>
                            <ul class="scenario-list">
                                <li>Complex master-slave or active-passive setup</li>
                                <li>Manual failover procedures or expensive clustering</li>
                                <li>Potential split-brain scenarios</li>
                                <li>Application-level connection management</li>
                                <li><strong>Minutes to hours of downtime during failures</strong></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="learning-points">
                        <h4 class="learning-title">üéØ Key Learning Points</h4>
                        <div class="points-grid">
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Automatic Failover</div>
                                <div class="point-description">See how elections happen and new primaries emerge</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Data Protection</div>
                                <div class="point-description">Watch real-time replication prevent data loss</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Read Scaling</div>
                                <div class="point-description">Experience how reads distribute across replicas</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Recovery Process</div>
                                <div class="point-description">Observe automatic member recovery and sync</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Majority Voting</div>
                                <div class="point-description">Learn how MongoDB prevents split-brain scenarios</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ No Primary State</div>
                                <div class="point-description">See what happens when majority is lost</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Retryable Operations</div>
                                <div class="point-description">Watch automatic retries handle transient failures</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Driver Resilience</div>
                                <div class="point-description">See how apps stay unaware of infrastructure issues</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Node Priority Configuration Section -->
                <div class="technical-section">
                    <h3 class="section-title">‚öôÔ∏è MongoDB Node Priority Configuration for 2-Node Quorum Scenarios</h3>
                    
                    <div class="priority-explanation">
                        <p><strong>Customer Concern:</strong> "What happens when a primary fails and only 2 nodes remain? Won't MongoDB become read-only?"</p>
                        
                        <div class="priority-config-box">
                            <h4>üîß Priority-Based Election Configuration</h4>
                            <p>MongoDB maintains write availability through strategic priority settings and proper replica set sizing with data-bearing nodes:</p>
                            
                            <div class="config-scenarios">
                                <div class="scenario-card mongodb-priority">
                                    <h5>Scenario 1: 3-Node Standard Replica Set</h5>
                                    <div class="node-config">
                                        <div class="config-node primary-node">Node A (Primary)<br>Priority: 2</div>
                                        <div class="config-node secondary-node">Node B (Secondary)<br>Priority: 1</div>
                                        <div class="config-node secondary-node">Node C (Secondary)<br>Priority: 1</div>
                                    </div>
                                    <p><strong>Result:</strong> If primary fails, Node B or C can become primary with majority vote (2/3 majority maintained)</p>
                                </div>
                                
                                <div class="scenario-card mongodb-priority">
                                    <h5>Scenario 2: Data-Bearing Priority Config</h5>
                                    <div class="node-config">
                                        <div class="config-node primary-node">Node A (Primary)<br>Priority: 3</div>
                                        <div class="config-node secondary-node">Node B (Secondary)<br>Priority: 2</div>
                                        <div class="config-node secondary-node">Node C (Secondary)<br>Priority: 1</div>
                                    </div>
                                    <p><strong>Configuration Command:</strong></p>
                                    <code>rs.reconfig({..., members: [{..., priority: 3}, {..., priority: 2}, {..., priority: 1}]})</code>
                                    <p><strong>Result:</strong> Node A preferred as primary, but B can take over if A fails and majority exists</p>
                                </div>
                            </div>
                            
                            <div class="priority-reality-check">
                                <h4>üéØ Reality Check: When MongoDB Stays Available</h4>
                                <ul class="priority-benefits">
                                    <li><strong>Majority Rule:</strong> With proper configuration, 2 out of 3 nodes can maintain write availability</li>
                                    <li><strong>Data-Bearing Nodes:</strong> All nodes store data and can serve reads, providing better resource utilization</li>
                                    <li><strong>Priority Weighting:</strong> Higher priority nodes become primary when available, ensuring predictable failover</li>
                                    <li><strong>No Single Points:</strong> Multiple nodes can serve as primary, unlike single-master systems</li>
                                </ul>
                                
                                <div class="two-node-scenario">
                                    <h5>‚ö†Ô∏è True 2-Node Limitation</h5>
                                    <p>MongoDB <em>intentionally</em> becomes read-only in true 2-node scenarios to prevent split-brain. This is a feature, not a limitation - it ensures data consistency over availability when network partitions occur.</p>
                                    <p><strong>Best Practice:</strong> Deploy with 3+ data-bearing nodes for optimal availability and resource utilization.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PostgreSQL WAL Comparison Section -->
                <div class="technical-section">
                    <h3 class="section-title">üêò PostgreSQL WAL-Based High Availability Comparison</h3>
                    
                    <div class="postgresql-comparison">
                        <p>PostgreSQL achieves high availability through Write-Ahead Logging (WAL) replication, similar to systems like Aurora and AlloyDB:</p>
                        
                        <div class="wal-scenarios">
                            <div class="scenario-card postgresql-wal">
                                <h5>PostgreSQL Streaming Replication</h5>
                                <div class="wal-architecture">
                                    <div class="wal-flow">
                                        <div class="wal-node primary-wal">Primary Server<br>WAL Writer</div>
                                        <div class="wal-arrow">‚Üí WAL Stream ‚Üí</div>
                                        <div class="wal-node standby-wal">Standby Server<br>WAL Receiver</div>
                                    </div>
                                </div>
                                
                                <div class="wal-failure-demo">
                                    <h6>Failure Scenario Walkthrough:</h6>
                                    <div class="failure-steps">
                                        <div class="step">
                                            <strong>1. Primary Failure Detection:</strong>
                                            <p>‚Ä¢ Connection manager (pgpool/HAProxy) detects primary failure</p>
                                            <p>‚Ä¢ Application connections start failing</p>
                                        </div>
                                        <div class="step">
                                            <strong>2. Manual Failover Process:</strong>
                                            <p>‚Ä¢ DBA manually promotes standby: <code>pg_promote()</code></p>
                                            <p>‚Ä¢ Or automatic with tools like Patroni/repmgr</p>
                                        </div>
                                        <div class="step">
                                            <strong>3. Application Reconnection:</strong>
                                            <p>‚Ä¢ Connection string updates required</p>
                                            <p>‚Ä¢ Load balancer reconfiguration</p>
                                            <p>‚Ä¢ Application restart may be needed</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="wal-limitations">
                                    <h6>‚ö†Ô∏è PostgreSQL HA Limitations:</h6>
                                    <ul>
                                        <li><strong>Manual Intervention:</strong> Requires DBA action or complex orchestration tools</li>
                                        <li><strong>Single Point of Failure:</strong> Only one primary can accept writes</li>
                                        <li><strong>Application Awareness:</strong> Apps must handle connection failures and reconnects</li>
                                        <li><strong>Split-Brain Risk:</strong> Without proper fencing, multiple primaries possible</li>
                                        <li><strong>Failover Time:</strong> Typically 30-60 seconds minimum for detection + promotion</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="scenario-card mongodb-advantage">
                                <h5>MongoDB Automatic Failover Advantage</h5>
                                <div class="mongodb-flow">
                                    <div class="auto-process">
                                        <div class="auto-step">
                                            <strong>Automatic Detection:</strong><br>
                                            Heartbeat failure (10s)
                                        </div>
                                        <div class="auto-arrow">‚Üì</div>
                                        <div class="auto-step">
                                            <strong>Automatic Election:</strong><br>
                                            Priority-based voting (2-3s)
                                        </div>
                                        <div class="auto-arrow">‚Üì</div>
                                        <div class="auto-step">
                                            <strong>Automatic Recovery:</strong><br>
                                            New primary ready (~15s total)
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mongodb-benefits">
                                    <h6>‚úÖ MongoDB HA Advantages:</h6>
                                    <ul>
                                        <li><strong>Zero Manual Intervention:</strong> Fully automated failover process</li>
                                        <li><strong>Driver Intelligence:</strong> Applications automatically discover new primary</li>
                                        <li><strong>Sub-15 Second Recovery:</strong> Typical failover in under 15 seconds</li>
                                        <li><strong>Built-in Split-Brain Prevention:</strong> Majority voting prevents dual primaries</li>
                                        <li><strong>Transparent to Apps:</strong> Retryable writes handle transient failures</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="reality-comparison">
                            <h4>üèÜ Real-World Impact Comparison</h4>
                            <div class="impact-table">
                                <table>
                                    <tr>
                                        <th>Aspect</th>
                                        <th>MongoDB Replica Sets</th>
                                        <th>PostgreSQL + WAL</th>
                                    </tr>
                                    <tr>
                                        <td><strong>Failover Time</strong></td>
                                        <td class="advantage">10-15 seconds (automatic)</td>
                                        <td class="disadvantage">30-60+ seconds (manual/scripted)</td>
                                    </tr>
                                    <tr>
                                        <td><strong>DBA Intervention</strong></td>
                                        <td class="advantage">None required</td>
                                        <td class="disadvantage">Manual promotion or complex tooling</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Application Changes</strong></td>
                                        <td class="advantage">None (driver handles automatically)</td>
                                        <td class="disadvantage">Connection handling, retries</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Split-Brain Prevention</strong></td>
                                        <td class="advantage">Built-in majority consensus</td>
                                        <td class="disadvantage">Requires fencing mechanisms</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <h3>üéÆ Demo Controls</h3>
            <button class="btn btn-danger" onclick="simulateFailure()" id="failureBtn">üí• Simulate Primary Failure</button>
            <button class="btn btn-primary" onclick="addSecondary()" id="addBtn">‚ûï Add Secondary</button>
            <button class="btn btn-primary" onclick="recoverMember()" id="recoverBtn" disabled>üîß Recover Failed Member</button>
            <button class="btn btn-primary" onclick="triggerElectionIfNeeded()" id="electionBtn">üó≥Ô∏è Force Election Check</button>
            <button class="btn btn-primary" onclick="performWrite()">‚úçÔ∏è Write Data</button>
            <button class="btn btn-primary" onclick="performRead()">üìñ Read Data</button>
            <button class="btn btn-primary" onclick="resetDemo()">üîÑ Reset Demo</button>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="uptimePercent">100.0%</div>
                <div class="stat-label">Write Availability</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="replicaCount">3</div>
                <div class="stat-label">Replica Members</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="writeCount">0</div>
                <div class="stat-label">Writes Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="readCount">0</div>
                <div class="stat-label">Reads Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="writeRetries">0</div>
                <div class="stat-label">Write Retries</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="readRetries">0</div>
                <div class="stat-label">Read Retries</div>
            </div>
        </div>

        <div class="architecture-section">
            <h3>üèóÔ∏è MongoDB Replica Set Architecture</h3>
            <div class="replica-set-container">
                <div class="replica-set-title">Replica Set: "myReplicaSet"</div>
                <div class="replication-flow" id="replicationFlow"></div>
                <div class="replica-members" id="replicaMembers">
                    <!-- Replica members will be rendered here -->
                </div>
            </div>
        </div>

        <div class="read-preferences">
            <h3>üìñ Read Preference Options</h3>
            <div class="read-option active" onclick="setReadPreference('primary')">
                <input type="radio" name="readPref" value="primary" checked>
                <div>
                    <strong>Primary</strong> - All reads from primary (strong consistency)
                </div>
            </div>
            <div class="read-option" onclick="setReadPreference('primaryPreferred')">
                <input type="radio" name="readPref" value="primaryPreferred">
                <div>
                    <strong>Primary Preferred</strong> - Primary first, then secondaries
                </div>
            </div>
            <div class="read-option" onclick="setReadPreference('secondary')">
                <input type="radio" name="readPref" value="secondary">
                <div>
                    <strong>Secondary</strong> - Only from secondaries (read scaling)
                </div>
            </div>
            <div class="read-option" onclick="setReadPreference('secondaryPreferred')">
                <input type="radio" name="readPref" value="secondaryPreferred">
                <div>
                    <strong>Secondary Preferred</strong> - Secondaries first, then primary
                </div>
            </div>
        </div>

        <div class="log-container">
            <h3>üìä Replica Set Activity Log</h3>
            <div class="log-content" id="logContainer"></div>
        </div>
        </div>
    </div>

    <script>
        // Global state
        let replicaMembers = [
            { id: 1, role: 'primary', status: 'healthy', host: 'rs-primary-001', port: 27017, lag: 0, priority: 1, term: 1 },
            { id: 2, role: 'secondary', status: 'healthy', host: 'rs-secondary-001', port: 27017, lag: 0, priority: 1, term: 1 },
            { id: 3, role: 'secondary', status: 'healthy', host: 'rs-secondary-002', port: 27017, lag: 0, priority: 1, term: 1 }
        ];
        
        let nextMemberId = 4;
        let writeCount = 0;
        let readCount = 0;
        let currentReadPreference = 'primary';
        let failedMembers = [];
        let electionInProgress = false;  // Prevent concurrent elections
        let currentTerm = 1;  // Global term number
        let noPrimaryStartTime = null;  // Track when system goes into no-primary state
        
        // Retryable operations tracking
        let writeRetryCount = 0;
        let readRetryCount = 0;
        let writeFailureCount = 0;
        let readFailureCount = 0;

        // Navigation Functions
        function toggleMobileMenu() {
            const navMenu = document.getElementById('navMenu');
            const backdrop = document.getElementById('navBackdrop');
            const toggleBtn = document.getElementById('menuToggle');
            
            navMenu.classList.toggle('open');
            backdrop.classList.toggle('active');
            toggleBtn.classList.toggle('menu-open');
            
            // Update ARIA attributes
            const isOpen = navMenu.classList.contains('open');
            toggleBtn.setAttribute('aria-expanded', isOpen);
        }

        function closeMobileMenu() {
            const navMenu = document.getElementById('navMenu');
            const backdrop = document.getElementById('navBackdrop');
            const toggleBtn = document.getElementById('menuToggle');
            
            navMenu.classList.remove('open');
            backdrop.classList.remove('active');
            toggleBtn.classList.remove('menu-open');
            
            // Update ARIA attributes
            toggleBtn.setAttribute('aria-expanded', 'false');
        }

        // Accordion Functions
        function toggleAccordion(categoryId) {
            const content = document.getElementById(categoryId + '-content');
            const icon = document.getElementById(categoryId + '-icon');
            const header = content.previousElementSibling;
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                icon.classList.remove('rotated');
                header.setAttribute('aria-expanded', 'false');
            } else {
                content.classList.add('expanded');
                icon.classList.add('rotated');
                header.setAttribute('aria-expanded', 'true');
            }
        }

        // Initialize accordion - expand category containing current page
        function initializeAccordion() {
            const content = document.getElementById('architecture-content');
            const icon = document.getElementById('architecture-icon');
            const header = content.previousElementSibling;
            
            content.classList.add('expanded');
            icon.classList.add('rotated');
            header.setAttribute('aria-expanded', 'true');
        }

        // Keyboard navigation support
        function initializeKeyboardNavigation() {
            document.addEventListener('keydown', (e) => {
                // Alt + M to toggle menu
                if (e.altKey && e.key === 'm') {
                    e.preventDefault();
                    toggleMobileMenu();
                }
                
                // Escape to close menu
                if (e.key === 'Escape') {
                    closeMobileMenu();
                }
                
                // Enter and Space for accordion headers
                if ((e.key === 'Enter' || e.key === ' ') && e.target.classList.contains('nav-category-header')) {
                    e.preventDefault();
                    const categoryId = e.target.onclick.toString().match(/'([^']+)'/)[1];
                    toggleAccordion(categoryId);
                }
            });
        }

        // Handle outside clicks
        function initializeOutsideClickHandler() {
            document.addEventListener('click', (e) => {
                const navMenu = document.getElementById('navMenu');
                const menuToggle = document.getElementById('menuToggle');
                
                // Close menu if clicking outside
                if (!navMenu.contains(e.target) && !menuToggle.contains(e.target)) {
                    closeMobileMenu();
                }
            });
        }

        // Navigation link click handler for mobile
        function initializeNavLinkHandlers() {
            const navLinks = document.querySelectorAll('.nav-menu a');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    if (window.innerWidth <= 1024) {
                        setTimeout(() => {
                            closeMobileMenu();
                        }, 100);
                    }
                });
            });
        }

        // Handle window resize
        function handleResize() {
            if (window.innerWidth > 1024) {
                closeMobileMenu();
            }
        }

        // Performance optimization - debounce resize events
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Logging function
        function logMessage(message, type = 'info') {
            const container = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        // Update statistics
        function updateStats() {
            // Simple logic: Primary available = 100%, No primary = 0%
            const healthyPrimary = replicaMembers.find(m => m.role === 'primary' && m.status === 'healthy');
            const writeAvailability = healthyPrimary ? 100.0 : 0.0;
            
            document.getElementById('uptimePercent').textContent = writeAvailability.toFixed(1) + '%';
            document.getElementById('replicaCount').textContent = replicaMembers.length;
            document.getElementById('writeCount').textContent = writeCount;
            document.getElementById('readCount').textContent = readCount;
            document.getElementById('writeRetries').textContent = writeRetryCount;
            document.getElementById('readRetries').textContent = readRetryCount;
        }

        // Check if majority of voting members are available
        function hasMajority() {
            const totalVotingMembers = replicaMembers.length;
            const healthyMembers = replicaMembers.filter(m => m.status === 'healthy').length;
            const majorityRequired = Math.floor(totalVotingMembers / 2) + 1;
            
            return healthyMembers >= majorityRequired;
        }

        // Render replica set visualization
        function renderReplicaSet() {
            const container = document.getElementById('replicaMembers');
            container.innerHTML = '';

            // Check if we have majority and a primary
            const hasMaj = hasMajority();
            const healthyPrimary = replicaMembers.find(m => m.role === 'primary' && m.status === 'healthy');
            
            // Add majority status indicator
            if (!hasMaj) {
                const majorityWarning = document.createElement('div');
                majorityWarning.style.cssText = `
                    grid-column: 1 / -1;
                    background: linear-gradient(135deg, #FDE8E8 0%, #FFF0F0 100%);
                    border: 2px solid #FF6B6B;
                    border-radius: 12px;
                    padding: 15px;
                    text-align: center;
                    margin-bottom: 20px;
                    color: #D32F2F;
                    font-weight: 600;
                `;
                const totalMembers = replicaMembers.length;
                const healthyMembers = replicaMembers.filter(m => m.status === 'healthy').length;
                const majorityRequired = Math.floor(totalMembers / 2) + 1;
                
                majorityWarning.innerHTML = `
                    üö´ <strong>NO MAJORITY AVAILABLE</strong><br>
                    ${healthyMembers}/${totalMembers} healthy (need ${majorityRequired} for primary election)<br>
                    <small>Writes unavailable until majority is restored</small>
                `;
                container.appendChild(majorityWarning);
            }

            replicaMembers.forEach(member => {
                const memberDiv = document.createElement('div');
                memberDiv.className = `replica-member ${member.role} ${member.status === 'down' ? 'down' : ''} ${member.status === 'recovering' ? 'recovering' : ''}`;
                memberDiv.id = `member-${member.id}`;

                let statusClass = 'status-healthy';
                let statusText = 'Healthy';
                
                if (member.status === 'down') {
                    statusClass = 'status-down';
                    statusText = 'Down';
                } else if (member.status === 'recovering') {
                    statusClass = 'status-syncing';
                    statusText = 'Syncing';
                }

                // Special handling for primary role display when no majority
                let roleDisplay = member.role.charAt(0).toUpperCase() + member.role.slice(1);
                if (member.role === 'primary' && !healthyPrimary && member.status === 'down') {
                    roleDisplay = 'Former Primary';
                }

                memberDiv.innerHTML = `
                    <div class="member-role ${member.role} ${member.status === 'down' ? 'down' : ''} ${member.status === 'recovering' ? 'recovering' : ''}">
                        ${roleDisplay}
                    </div>
                    <div class="member-details">
                        <div><strong>${member.host}</strong></div>
                        <div>Port: ${member.port}</div>
                        <div class="member-status ${statusClass}">${statusText}</div>
                        ${member.status === 'healthy' ? `<div style="font-size: 0.8em; color: #666;">Term: ${member.term} | Priority: ${member.priority}</div>` : ''}
                        ${member.role === 'secondary' && member.status === 'healthy' ? `<div style="font-size: 0.8em; color: #666;">Lag: ${member.lag}ms</div>` : ''}
                    </div>
                `;

                container.appendChild(memberDiv);
            });

            updateStats();
        }

        // MongoDB-style election algorithm
        function conductElection(triggerReason = 'unknown') {
            // Prevent concurrent elections
            if (electionInProgress) {
                logMessage('üó≥Ô∏è Election already in progress, skipping...', 'warning');
                return;
            }

            // Check if majority exists
            if (!hasMajority()) {
                const totalMembers = replicaMembers.length;
                const healthyMembers = replicaMembers.filter(m => m.status === 'healthy').length;
                const majorityRequired = Math.floor(totalMembers / 2) + 1;
                logMessage(`‚ùå Cannot start election: No majority (${healthyMembers}/${totalMembers}, need ${majorityRequired})`, 'error');
                return;
            }

            // Check if we already have a healthy primary
            const existingPrimary = replicaMembers.find(m => m.role === 'primary' && m.status === 'healthy');
            if (existingPrimary) {
                logMessage(`‚úÖ Primary already exists: ${existingPrimary.host} (term ${existingPrimary.term})`, 'info');
                return;
            }

            electionInProgress = true;
            currentTerm++; // Increment term for this election
            
            logMessage(`üó≥Ô∏è Starting election (term ${currentTerm}) - reason: ${triggerReason}`, 'warning');

            // Step 1: Dry Election - find best candidate
            const eligibleCandidates = replicaMembers.filter(m => 
                m.status === 'healthy' && m.priority > 0
            );

            if (eligibleCandidates.length === 0) {
                logMessage('‚ùå No eligible candidates for election', 'error');
                electionInProgress = false;
                return;
            }

            // Step 2: Select candidate based on MongoDB's rules:
            // 1. Highest priority
            // 2. Most recent data (lowest lag as proxy for optime)
            // 3. Lowest member ID (tiebreaker)
            eligibleCandidates.sort((a, b) => {
                if (a.priority !== b.priority) return b.priority - a.priority; // Higher priority first
                if (a.lag !== b.lag) return a.lag - b.lag; // Lower lag (fresher data) first
                return a.id - b.id; // Lower ID as tiebreaker
            });

            const candidate = eligibleCandidates[0];
            
            logMessage(`üèÜ Best candidate: ${candidate.host} (priority: ${candidate.priority}, lag: ${candidate.lag}ms)`, 'info');

            // Step 3: Voting process (simplified)
            setTimeout(() => {
                const healthyVotingMembers = replicaMembers.filter(m => m.status === 'healthy');
                const votesNeeded = Math.floor(healthyVotingMembers.length / 2) + 1;
                const votesReceived = healthyVotingMembers.length; // All healthy members vote for best candidate
                
                if (votesReceived >= votesNeeded) {
                    // Step 4: Step down any existing primaries (even failed ones)
                    replicaMembers.forEach(member => {
                        if (member.role === 'primary') {
                            member.role = 'secondary';
                            if (member.status === 'healthy') {
                                logMessage(`üìâ ${member.host} stepped down from primary (lower term)`, 'info');
                            }
                        }
                    });

                    // Step 5: Elect new primary
                    candidate.role = 'primary';
                    candidate.term = currentTerm;
                    candidate.lag = 0; // Primary has no lag
                    
                    // Update all members to current term
                    replicaMembers.forEach(member => {
                        if (member.status === 'healthy') {
                            member.term = currentTerm;
                        }
                    });

                    const totalMembers = replicaMembers.length;
                    const healthyMembers = replicaMembers.filter(m => m.status === 'healthy').length;
                    
                    logMessage(`‚úÖ Election successful! ${candidate.host} elected PRIMARY`, 'success');
                    logMessage(`üìä Votes: ${votesReceived}/${healthyVotingMembers.length} (needed ${votesNeeded})`, 'success');
                    logMessage(`üè∑Ô∏è New term: ${currentTerm}`, 'info');
                    logMessage('üîÑ Replica set is operational', 'success');
                } else {
                    logMessage(`‚ùå Election failed: insufficient votes (${votesReceived}/${votesNeeded})`, 'error');
                }

                electionInProgress = false;
                renderReplicaSet();
            }, 3000); // 3-second election process
        }

        // Simulate primary failure and election
        function simulateFailure() {
            const primary = replicaMembers.find(m => m.role === 'primary');
            if (!primary) {
                logMessage('No primary to fail!', 'warning');
                return;
            }

            logMessage(`üí• Primary ${primary.host} has failed!`, 'error');
            primary.status = 'down';
            primary.role = 'secondary'; // Failed primary becomes secondary
            failedMembers.push(primary.id);
            
            document.getElementById('failureBtn').disabled = true;
            document.getElementById('recoverBtn').disabled = false;

            renderReplicaSet();

            // Trigger election after brief delay (simulates heartbeat timeout)
            setTimeout(() => {
                conductElection('primary failure');
                document.getElementById('failureBtn').disabled = false;
            }, 1000);
        }

        // Wrapper function for backward compatibility and manual triggers
        function triggerElectionIfNeeded() {
            conductElection('manual trigger');
        }

        // Add a new secondary member
        function addSecondary() {
            const newMember = {
                id: nextMemberId++,
                role: 'secondary',
                status: 'recovering',
                host: `rs-secondary-${String(nextMemberId - 1).padStart(3, '0')}`,
                port: 27017,
                lag: 5000,
                priority: 1,
                term: currentTerm
            };

            replicaMembers.push(newMember);
            logMessage(`‚ûï Adding new secondary: ${newMember.host}`, 'warning');
            logMessage('üìä Initial sync started...', 'warning');
            
            renderReplicaSet();

            // Simulate initial sync process
            setTimeout(() => {
                newMember.status = 'healthy';
                newMember.lag = Math.floor(Math.random() * 100) + 10;
                logMessage(`‚úÖ ${newMember.host} sync complete - now accepting reads`, 'success');
                renderReplicaSet();
                
                // Check if this new member enables an election
                setTimeout(() => conductElection('new member joined'), 1000);
            }, 4000);
        }

        // Recover a failed member
        function recoverMember() {
            if (failedMembers.length === 0) {
                logMessage('No failed members to recover', 'warning');
                return;
            }

            const memberId = failedMembers.pop();
            const member = replicaMembers.find(m => m.id === memberId);
            
            if (member) {
                logMessage(`üîß Recovering ${member.host}...`, 'warning');
                member.status = 'recovering';
                renderReplicaSet();

                setTimeout(() => {
                    member.status = 'healthy';
                    member.lag = Math.floor(Math.random() * 200) + 50;
                    member.term = currentTerm; // Update to current term
                    logMessage(`‚úÖ ${member.host} recovered and synced`, 'success');
                    renderReplicaSet();
                    
                    // Check if this recovery enables an election
                    setTimeout(() => conductElection('member recovery'), 1000);
                    
                    if (failedMembers.length === 0) {
                        document.getElementById('recoverBtn').disabled = true;
                    }
                }, 3000);
            }
        }

        // Simulate retryable write operation (MongoDB driver behavior)
        function performWrite() {
            // First attempt
            logMessage('üìù Attempting write operation...', 'info');
            
            // Check for various failure scenarios that trigger retries
            const primary = replicaMembers.find(m => m.role === 'primary' && m.status === 'healthy');
            const isElectionInProgress = electionInProgress;
            const simulateNetworkError = Math.random() < 0.1; // 10% chance of transient network error
            
            // First attempt - check for immediate failures
            if (!primary && !hasMajority()) {
                writeFailureCount++;
                logMessage('‚ùå Write failed: No primary available and no majority for election', 'error');
                logMessage('üö´ Operation cannot be retried - insufficient nodes', 'error');
                return;
            }
            
            // Simulate first attempt failure scenarios
            if (!primary || isElectionInProgress || simulateNetworkError) {
                let failureReason = '';
                if (!primary) failureReason = 'no primary (election needed)';
                else if (isElectionInProgress) failureReason = 'election in progress';
                else if (simulateNetworkError) failureReason = 'network timeout';
                
                logMessage(`‚ö†Ô∏è Write attempt 1 failed: ${failureReason}`, 'warning');
                logMessage('üîÑ Driver initiating automatic retry...', 'warning');
                writeRetryCount++;
                
                // MongoDB driver waits briefly then retries
                setTimeout(() => {
                    // Second attempt - retry logic
                    const retryPrimary = replicaMembers.find(m => m.role === 'primary' && m.status === 'healthy');
                    const retryElectionInProgress = electionInProgress;
                    
                    if (retryPrimary && !retryElectionInProgress) {
                        // Retry succeeded
                        writeCount++;
                        logMessage(`‚úÖ Write retry succeeded on ${retryPrimary.host}`, 'success');
                        logMessage('üéØ Retryable writes: Application unaware of initial failure', 'success');
                        
                        // Show replication flow animation
                        const flow = document.getElementById('replicationFlow');
                        flow.classList.add('active');
                        
                        setTimeout(() => {
                            flow.classList.remove('active');
                            logMessage('üì§ Data replicated to all healthy secondaries', 'success');
                            
                            // Update secondary lag
                            replicaMembers.forEach(member => {
                                if (member.role === 'secondary' && member.status === 'healthy') {
                                    member.lag = Math.floor(Math.random() * 100) + 10;
                                }
                            });
                            renderReplicaSet();
                        }, 2000);
                    } else {
                        // Retry also failed
                        writeFailureCount++;
                        let retryFailureReason = !retryPrimary ? 'still no primary' : 'election still in progress';
                        logMessage(`‚ùå Write retry failed: ${retryFailureReason}`, 'error');
                        logMessage('üö´ Driver exhausted retries - returning error to application', 'error');
                    }
                    
                    updateStats();
                }, 1500); // 1.5 second retry delay
                
            } else {
                // First attempt succeeded
                writeCount++;
                logMessage(`‚úÖ Write succeeded on ${primary.host}`, 'success');
                
                // Show replication flow animation
                const flow = document.getElementById('replicationFlow');
                flow.classList.add('active');
                
                setTimeout(() => {
                    flow.classList.remove('active');
                    logMessage('üì§ Data replicated to all healthy secondaries', 'success');
                    
                    // Update secondary lag
                    replicaMembers.forEach(member => {
                        if (member.role === 'secondary' && member.status === 'healthy') {
                            member.lag = Math.floor(Math.random() * 100) + 10;
                        }
                    });
                    renderReplicaSet();
                }, 2000);
            }
            
            updateStats();
        }

        // Simulate retryable read operation (MongoDB driver behavior)
        function performRead() {
            logMessage('üìñ Attempting read operation...', 'info');
            
            // Simulate network errors or temporary unavailability
            const simulateNetworkError = Math.random() < 0.15; // 15% chance of transient network error
            const simulateSecondaryLag = Math.random() < 0.1; // 10% chance secondary is too far behind
            
            let targetMember = null;
            const healthyPrimary = replicaMembers.find(m => m.role === 'primary' && m.status === 'healthy');
            const healthySecondaries = replicaMembers.filter(m => m.role === 'secondary' && m.status === 'healthy');

            // Determine target based on read preference
            switch (currentReadPreference) {
                case 'primary':
                    targetMember = healthyPrimary;
                    break;
                case 'primaryPreferred':
                    targetMember = healthyPrimary || (healthySecondaries.length > 0 ? healthySecondaries[0] : null);
                    break;
                case 'secondary':
                    targetMember = healthySecondaries.length > 0 ? healthySecondaries[Math.floor(Math.random() * healthySecondaries.length)] : null;
                    break;
                case 'secondaryPreferred':
                    targetMember = healthySecondaries.length > 0 ? healthySecondaries[Math.floor(Math.random() * healthySecondaries.length)] : healthyPrimary;
                    break;
            }

            // First attempt
            if (!targetMember || simulateNetworkError || (targetMember.role === 'secondary' && simulateSecondaryLag)) {
                let failureReason = '';
                if (!targetMember) failureReason = `no healthy members for read preference: ${currentReadPreference}`;
                else if (simulateNetworkError) failureReason = 'network timeout to selected member';
                else if (simulateSecondaryLag) failureReason = 'secondary too far behind (exceeds maxStalenessSeconds)';
                
                logMessage(`‚ö†Ô∏è Read attempt 1 failed: ${failureReason}`, 'warning');
                logMessage('üîÑ Driver initiating automatic retry with different member...', 'warning');
                readRetryCount++;
                
                // Retry with different logic
                setTimeout(() => {
                    let retryTargetMember = null;
                    
                    // For retries, MongoDB often falls back to more permissive selection
                    if (currentReadPreference === 'secondary' && healthyPrimary) {
                        // Fall back to primary if secondaries are having issues
                        retryTargetMember = healthyPrimary;
                        logMessage('üìã Retry: Falling back to primary due to secondary issues', 'info');
                    } else {
                        // Try different member of same type
                        switch (currentReadPreference) {
                            case 'primary':
                                retryTargetMember = healthyPrimary;
                                break;
                            case 'primaryPreferred':
                                retryTargetMember = healthyPrimary || (healthySecondaries.length > 0 ? healthySecondaries[0] : null);
                                break;
                            case 'secondary':
                                retryTargetMember = healthySecondaries.length > 0 ? healthySecondaries[Math.floor(Math.random() * healthySecondaries.length)] : null;
                                break;
                            case 'secondaryPreferred':
                                retryTargetMember = healthySecondaries.length > 0 ? healthySecondaries[Math.floor(Math.random() * healthySecondaries.length)] : healthyPrimary;
                                break;
                        }
                    }
                    
                    if (retryTargetMember) {
                        readCount++;
                        logMessage(`‚úÖ Read retry succeeded from ${retryTargetMember.host} (${retryTargetMember.role})`, 'success');
                        logMessage('üéØ Retryable reads: Application unaware of initial failure', 'success');
                    } else {
                        readFailureCount++;
                        logMessage(`‚ùå Read retry failed: No suitable members available`, 'error');
                        logMessage('üö´ Driver exhausted retries - returning error to application', 'error');
                    }
                    
                    updateStats();
                }, 1000); // 1 second retry delay
                
            } else {
                // First attempt succeeded
                readCount++;
                logMessage(`‚úÖ Read succeeded from ${targetMember.host} (${targetMember.role})`, 'success');
            }
            
            updateStats();
        }

        // Set read preference
        function setReadPreference(preference) {
            currentReadPreference = preference;
            
            // Update UI
            document.querySelectorAll('.read-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.closest('.read-option').classList.add('active');
            
            // Update radio button
            document.querySelector(`input[value="${preference}"]`).checked = true;
            
            logMessage(`üìã Read preference changed to: ${preference}`, 'info');
        }

        // Reset demo
        function resetDemo() {
            replicaMembers = [
                { id: 1, role: 'primary', status: 'healthy', host: 'rs-primary-001', port: 27017, lag: 0, priority: 1, term: 1 },
                { id: 2, role: 'secondary', status: 'healthy', host: 'rs-secondary-001', port: 27017, lag: 0, priority: 1, term: 1 },
                { id: 3, role: 'secondary', status: 'healthy', host: 'rs-secondary-002', port: 27017, lag: 0, priority: 1, term: 1 }
            ];
            
            nextMemberId = 4;
            writeCount = 0;
            readCount = 0;
            uptimeStart = Date.now();
            totalDowntime = 0;
            failedMembers = [];
            electionInProgress = false;
            currentTerm = 1;
            noPrimaryStartTime = null;
            
            document.getElementById('failureBtn').disabled = false;
            document.getElementById('recoverBtn').disabled = true;
            document.getElementById('logContainer').innerHTML = '';
            
            renderReplicaSet();
            logMessage('üîÑ Demo reset to initial 3-member replica set', 'info');
            logMessage('üéØ Replica set initialized with term 1', 'success');
        }

        // Toggle demo overview section
        function toggleDemoOverview() {
            const overview = document.getElementById('demoOverview');
            const toggle = document.getElementById('demoToggle');
            
            if (overview.style.display === 'none') {
                overview.style.display = 'block';
                toggle.textContent = '‚ñ≤';
                toggle.style.transform = 'rotate(180deg)';
            } else {
                overview.style.display = 'none';
                toggle.textContent = '‚ñº';
                toggle.style.transform = 'rotate(0deg)';
            }
        }

        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            initializeAccordion();
            initializeKeyboardNavigation();
            initializeOutsideClickHandler();
            initializeNavLinkHandlers();
            
            // Add debounced resize handler
            window.addEventListener('resize', debounce(handleResize, 150));
            
            // Initialize demo - ensure initial render
            updateStats();
            renderReplicaSet();
            logMessage('üéâ MongoDB Replica Set demo initialized', 'success');
            logMessage('üîß 3-member replica set active with automatic failover', 'info');
            logMessage('üìä Election algorithm: Priority-based with term management', 'info');
            logMessage('üîÑ Retryable operations: Automatic driver resilience enabled', 'info');
            logMessage('üöÄ Try performing operations during failures to see retries!', 'info');
            
            console.log('MongoDB Replica Set Demo - Loaded Successfully');
            console.log('Use Alt+M to toggle menu, ESC to close menu');
        });
        
        // Also initialize on window load as fallback
        window.addEventListener('load', function() {
            // Ensure rendering happens even if DOMContentLoaded missed
            if (document.getElementById('replicaMembers').children.length === 0) {
                console.log('Fallback initialization triggered');
                updateStats();
                renderReplicaSet();
            }
        });

        // Handle page visibility for performance
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // Pause animations when page is not visible (except for critical replica animations)
                document.querySelectorAll('.nav-accordion-content li').forEach(el => {
                    el.style.animationPlayState = 'paused';
                });
            } else {
                // Resume animations when page becomes visible
                document.querySelectorAll('.nav-accordion-content li').forEach(el => {
                    el.style.animationPlayState = 'running';
                });
            }
        });

        // Error handling for navigation
        window.addEventListener('error', function(e) {
            console.warn('Navigation error:', e.error);
            // Ensure menu can still be closed if there's an error
            if (document.getElementById('navMenu').classList.contains('open')) {
                closeMobileMenu();
            }
        });
    </script>
</body>
</html>
