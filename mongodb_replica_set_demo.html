<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YCV5KGB8ES"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-YCV5KGB8ES');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB Replica Set High Availability</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Akzidenz', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #001E2B 0%, #00684A 50%, #00ED64 100%);
            color: #001E2B;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
        }

        .nav-menu {
            width: 300px;
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            box-shadow: 4px 0 20px rgba(0, 30, 43, 0.15);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            border-right: 1px solid rgba(0, 237, 100, 0.2);
        }

        .nav-menu h2 {
            margin-bottom: 25px;
            color: #00684A;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 3px solid #00ED64;
            font-size: 1.4em;
            font-weight: 700;
            background: linear-gradient(45deg, #00ED64, #00B84D);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-menu ul {
            list-style: none;
        }

        .nav-menu li {
            margin-bottom: 12px;
        }

        .nav-menu a {
            display: block;
            padding: 12px 18px;
            text-decoration: none;
            color: #001E2B;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            font-weight: 500;
        }

        .nav-menu a:hover, .nav-menu a.active {
            background: linear-gradient(135deg, #E8F5E8 0%, #F0FFF0 100%);
            border-left: 4px solid #00ED64;
            transform: translateX(8px);
            color: #00684A;
            box-shadow: 0 4px 12px rgba(0, 237, 100, 0.2);
        }

        .nav-category {
            font-weight: 700;
            color: #00684A;
            margin-top: 30px;
            margin-bottom: 15px;
            padding: 10px 18px;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid rgba(0, 237, 100, 0.3);
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.1), rgba(0, 184, 77, 0.1));
            border-radius: 6px;
        }

        .nav-category:first-of-type {
            margin-top: 20px;
        }

        .mobile-menu-toggle {
            display: none;
        }

        .container {
            flex: 1;
            margin-left: 300px;
            max-width: none;
            padding: 30px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            font-weight: 700;
            background: linear-gradient(45deg, #00ED64, #00B84D);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
        }

        .header p {
            font-size: 1.3em;
            opacity: 0.9;
            font-weight: 400;
        }

        .so-what-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin: 25px auto;
            max-width: 900px;
            box-shadow: 0 8px 32px rgba(0, 30, 43, 0.15);
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .so-what-title {
            color: #00684A;
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .so-what-text {
            color: #001E2B;
            font-size: 1.1em;
            line-height: 1.7;
            margin-bottom: 20px;
            font-weight: 400;
        }

        .real-impact-box {
            background: linear-gradient(135deg, #E8F5E8 0%, #F0FFF0 100%);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #00ED64;
            margin-top: 20px;
        }

        .real-impact-text {
            color: #001E2B;
            font-weight: 600;
            font-size: 1.05em;
        }

        .demo-overview-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 25px;
            margin: 25px auto;
            max-width: 900px;
            box-shadow: 0 8px 32px rgba(0, 30, 43, 0.15);
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .demo-toggle-header {
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .demo-toggle-header:hover {
            transform: translateY(-2px);
        }

        .demo-toggle-title {
            color: #001E2B;
            margin: 0;
            font-size: 1.4em;
            font-weight: 600;
        }

        .demo-toggle-icon {
            color: #00684A;
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .demo-content {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #E8F5E8;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .scenario-card {
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 30, 43, 0.1);
        }

        .mongo-scenario {
            background: linear-gradient(135deg, #E8F5E8 0%, #F0FFF0 100%);
            border: 1px solid #00ED64;
        }

        .traditional-scenario {
            background: linear-gradient(135deg, #FDE8E8 0%, #FFF0F0 100%);
            border: 1px solid #FF6B6B;
        }

        .scenario-title {
            margin-bottom: 15px;
            font-weight: 600;
            font-size: 1.2em;
        }

        .mongo-title {
            color: #00684A;
        }

        .traditional-title {
            color: #D32F2F;
        }

        .scenario-list {
            color: #001E2B;
            line-height: 1.7;
            margin: 0;
            padding-left: 20px;
        }

        .scenario-list li {
            margin-bottom: 8px;
        }

        .scenario-list strong {
            color: #00684A;
        }

        .traditional-scenario .scenario-list strong {
            color: #D32F2F;
        }

        .learning-points {
            background: linear-gradient(135deg, #F8F9FA 0%, #FFFFFF 100%);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #E8F5E8;
        }

        .learning-title {
            color: #001E2B;
            margin-bottom: 20px;
            font-weight: 600;
            font-size: 1.2em;
        }

        .points-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .learning-point {
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 30, 43, 0.05);
            border-left: 3px solid #00ED64;
        }

        .point-title {
            color: #00684A;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .point-description {
            color: #001E2B;
            font-size: 0.95em;
            opacity: 0.8;
        }

        .controls {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 30, 43, 0.15);
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .controls h3 {
            color: #00684A;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 600;
        }

        .btn {
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00ED64, #00B84D);
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #00B84D, #00684A);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 237, 100, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #FF6B6B, #D32F2F);
        }

        .btn-danger:hover:not(:disabled) {
            background: linear-gradient(135deg, #D32F2F, #B71C1C);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 30, 43, 0.15);
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .stat-number {
            font-size: 2.2em;
            font-weight: 700;
            color: #00684A;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #001E2B;
            font-weight: 500;
            opacity: 0.8;
        }

        .architecture-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 30, 43, 0.15);
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .architecture-section h3 {
            color: #00684A;
            margin-bottom: 25px;
            font-size: 1.6em;
            font-weight: 600;
            text-align: center;
        }

        .replica-set-container {
            background: linear-gradient(135deg, #F8FFF8 0%, #F0FFF0 100%);
            border: 2px solid #00ED64;
            border-radius: 15px;
            padding: 30px;
            position: relative;
            min-height: 300px;
        }

        .replica-set-title {
            position: absolute;
            top: -15px;
            left: 20px;
            background: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            color: #00684A;
            border: 2px solid #00ED64;
        }

        .replica-members {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .replica-member {
            background: white;
            border: 3px solid #00ED64;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            min-width: 180px;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 30, 43, 0.1);
        }

        .replica-member:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 30, 43, 0.15);
        }

        .replica-member.primary {
            border-color: #00ED64;
            background: linear-gradient(135deg, #E8F5E8 0%, #F0FFF0 100%);
        }

        .replica-member.secondary {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #F8F9FA 0%, #FFFFFF 100%);
        }

        .replica-member.down {
            border-color: #FF6B6B;
            background: linear-gradient(135deg, #FDE8E8 0%, #FFF0F0 100%);
            opacity: 0.7;
        }

        .replica-member.recovering {
            border-color: #FFC107;
            background: linear-gradient(135deg, #FFF8E1 0%, #FFFACD 100%);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
            100% { opacity: 1; transform: scale(1); }
        }

        .member-role {
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 8px;
            color: white;
        }

        .member-role.primary {
            background: linear-gradient(135deg, #00ED64, #00B84D);
        }

        .member-role.secondary {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }

        .member-role.down {
            background: linear-gradient(135deg, #FF6B6B, #D32F2F);
        }

        .member-role.recovering {
            background: linear-gradient(135deg, #FFC107, #FF8F00);
        }

        .member-details {
            font-size: 0.9em;
            color: #001E2B;
        }

        .member-status {
            margin: 5px 0;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .status-healthy {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .status-down {
            background: #FDE8E8;
            color: #D32F2F;
        }

        .status-syncing {
            background: #FFF8E1;
            color: #F57C00;
        }

        .replication-flow {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ED64, transparent);
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .replication-flow.active {
            opacity: 1;
            animation: flow 2s infinite;
        }

        @keyframes flow {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .read-preferences {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 30, 43, 0.15);
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .read-preferences h3 {
            color: #00684A;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 600;
        }

        .read-option {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            background: #F8F9FA;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .read-option:hover {
            border-color: #00ED64;
            background: #F0FFF0;
        }

        .read-option.active {
            border-color: #00ED64;
            background: linear-gradient(135deg, #E8F5E8 0%, #F0FFF0 100%);
        }

        .read-option input[type="radio"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #00ED64;
            border-radius: 50%;
            position: relative;
        }

        .read-option input[type="radio"]:checked::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: #00ED64;
            border-radius: 50%;
        }

        .log-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 30, 43, 0.15);
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .log-container h3 {
            color: #00684A;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 600;
        }

        .log-content {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 0.9em;
        }

        .log-entry {
            margin: 5px 0;
            padding: 8px;
            border-left: 3px solid #00ED64;
            background: rgba(0, 237, 100, 0.1);
            border-radius: 0 6px 6px 0;
        }

        .log-entry.warning {
            border-left-color: #FFC107;
            background: rgba(255, 193, 7, 0.1);
        }

        .log-entry.error {
            border-left-color: #FF6B6B;
            background: rgba(255, 107, 107, 0.1);
        }

        .log-entry.success {
            border-left-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        @media (max-width: 768px) {
            .nav-menu {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1000;
            }
            
            .nav-menu.open {
                transform: translateX(0);
            }
            
            .container {
                margin-left: 0;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .mobile-menu-toggle {
                display: block;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 1001;
                background: linear-gradient(135deg, #00ED64, #00B84D);
                color: #001E2B;
                border: none;
                padding: 12px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 1.2em;
                box-shadow: 0 4px 12px rgba(0, 237, 100, 0.3);
            }

            .scenario-grid {
                grid-template-columns: 1fr;
            }
            
            .replica-members {
                flex-direction: column;
            }
            
            .controls, .architecture-section {
                padding: 20px;
            }

            .btn {
                margin: 3px;
                padding: 10px 16px;
                font-size: 13px;
            }

            .points-grid {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .replica-member {
                min-width: 90%;
                margin-bottom: 10px;
            }
        }

        @media (max-width: 1024px) {
            .nav-menu {
                width: 280px;
            }
            
            .container {
                margin-left: 280px;
                padding: 25px;
            }
        }

        @media (max-width: 480px) {
            .stats {
                grid-template-columns: 1fr;
            }

            .controls {
                padding: 15px;
            }

            .btn {
                width: 100%;
                margin: 5px 0;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .replica-member {
                padding: 15px;
                min-width: 100%;
            }
        }

        /* Accordion Styles */
        .nav-accordion {
            margin-bottom: 8px;
        }

        .nav-category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 18px;
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.1), rgba(0, 184, 77, 0.1));
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            color: #00684A;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid rgba(0, 237, 100, 0.2);
        }

        .nav-category-header:hover {
            background: linear-gradient(135deg, rgba(0, 237, 100, 0.2), rgba(0, 184, 77, 0.2));
            transform: translateX(4px);
        }

        .accordion-icon {
            transition: transform 0.3s ease;
            font-size: 0.8em;
            color: #00684A;
        }

        .accordion-icon.rotated {
            transform: rotate(180deg);
        }

        .nav-accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-accordion-content.expanded {
            max-height: 300px;
        }

        .nav-accordion-content li {
            margin-bottom: 8px;
            margin-left: 15px;
        }

        .nav-accordion-content a {
            display: block;
            padding: 10px 15px;
            text-decoration: none;
            color: #001E2B;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 6px;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-weight: 500;
            font-size: 0.9em;
        }

        .nav-accordion-content a:hover, .nav-accordion-content a.active {
            background: linear-gradient(135deg, #E8F5E8 0%, #F0FFF0 100%);
            border-left: 3px solid #00ED64;
            transform: translateX(6px);
            color: #00684A;
            box-shadow: 0 3px 10px rgba(0, 237, 100, 0.2);
        }
    </style>
</head>
<body>
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">‚ò∞</button>
    
    <div class="nav-menu" id="navMenu">
        <h2>MongoDB vs SQL</h2>
        <ul>
            <li><a href="index.html">üè† Home</a></li>
            
            <li class="nav-accordion">
                <div class="nav-category-header" onclick="toggleAccordion('architecture')">
                    <span>Architecture & Performance</span>
                    <span class="accordion-icon" id="architecture-icon">‚ñº</span>
                </div>
                <ul class="nav-accordion-content" id="architecture-content">
                    <li><a href="mongodb_replica_set_demo.html" class="active">üîÑ High Availability</a></li>
                    <li><a href="horizontal_scaling_presentation.html">üìà Horizontal Scaling</a></li>
                </ul>
            </li>
            
            <li class="nav-accordion">
                <div class="nav-category-header" onclick="toggleAccordion('development')">
                    <span>Application Development</span>
                    <span class="accordion-icon" id="development-icon">‚ñº</span>
                </div>
                <ul class="nav-accordion-content" id="development-content">
                    <li><a href="orm_vs_natural_objects_presentation.html">üîß ORM vs Natural Objects</a></li>  
                    <li><a href="schema_evolution_presentation.html">üöÄ Schema Evolution</a></li>
                    <li><a href="arrays_embedded_docs_presentation.html">üìä Arrays & Embedded Docs</a></li>
                    <li><a href="aggregation_pipeline_presentation.html">‚ö° Aggregation Pipeline</a></li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="container">
        <div class="header">
            <h1>üîÑ MongoDB Replica Set High Availability</h1>
            <p>Interactive Demo: Automatic Failover & Data Protection</p>
            
            <!-- So What Section -->
            <div class="so-what-section">
                <h2 class="so-what-title">üõ°Ô∏è Why This Matters: The Zero-Downtime Promise</h2>
                <p class="so-what-text">
                    Traditional databases often require complex clustering solutions, expensive third-party tools, or manual failover procedures that can take <strong>minutes or hours</strong> to restore service during failures. During this time, your application is completely unavailable.
                </p>
                <p class="so-what-text">
                    <strong>MongoDB's differentiator:</strong> Built-in replica sets provide automatic failover in <strong>seconds</strong>, continuous data protection, and transparent read scaling. No additional clustering software, no manual intervention, no single points of failure.
                </p>
                <div class="real-impact-box">
                    <div class="real-impact-text">
                        <strong>Real Impact:</strong> Applications achieve 99.99%+ uptime with automatic recovery, eliminate data loss risks, and scale read operations across multiple servers without architectural changes.
                    </div>
                </div>
            </div>

            <!-- Expandable Demo Overview -->
            <div class="demo-overview-section">
                <div class="demo-toggle-header" onclick="toggleDemoOverview()">
                    <h3 class="demo-toggle-title">üìã What This Demo Shows</h3>
                    <span id="demoToggle" class="demo-toggle-icon">‚ñº</span>
                </div>
                
                <div id="demoOverview" style="display: none;" class="demo-content">
                    <div class="scenario-grid">
                        <div class="scenario-card mongo-scenario">
                            <h4 class="scenario-title mongo-title">üçÉ MongoDB Replica Set</h4>
                            <ul class="scenario-list">
                                <li>MongoDB replica set with Primary/Secondary roles and automatic elections</li>
                                <li>Real-time data replication via oplog</li>
                                <li>Intelligent leader election (<strong>majority voting required</strong>)</li>
                                <li>Read scaling across secondary members</li>
                                <li><strong>Retryable writes and reads</strong> for automatic resilience</li>
                                <li><strong>Sub-10 second failover with zero data loss</strong></li>
                                <li><strong>Prevents split-brain with majority consensus</strong></li>
                            </ul>
                        </div>
                        
                        <div class="scenario-card traditional-scenario">
                            <h4 class="scenario-title traditional-title">üóÑÔ∏è Traditional Database Clustering</h4>
                            <ul class="scenario-list">
                                <li>Complex master-slave or active-passive setup</li>
                                <li>Manual failover procedures or expensive clustering</li>
                                <li>Potential split-brain scenarios</li>
                                <li>Application-level connection management</li>
                                <li><strong>Minutes to hours of downtime during failures</strong></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="learning-points">
                        <h4 class="learning-title">üéØ Key Learning Points</h4>
                        <div class="points-grid">
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Automatic Failover</div>
                                <div class="point-description">See how elections happen and new primaries emerge</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Data Protection</div>
                                <div class="point-description">Watch real-time replication prevent data loss</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Read Scaling</div>
                                <div class="point-description">Experience how reads distribute across replicas</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Recovery Process</div>
                                <div class="point-description">Observe automatic member recovery and sync</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Majority Voting</div>
                                <div class="point-description">Learn how MongoDB prevents split-brain scenarios</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ No Primary State</div>
                                <div class="point-description">See what happens when majority is lost</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Retryable Operations</div>
                                <div class="point-description">Watch automatic retries handle transient failures</div>
                            </div>
                            <div class="learning-point">
                                <div class="point-title">‚úÖ Driver Resilience</div>
                                <div class="point-description">See how apps stay unaware of infrastructure issues</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <h3>üéÆ Demo Controls</h3>
            <button class="btn btn-danger" onclick="simulateFailure()" id="failureBtn">üí• Simulate Primary Failure</button>
            <button class="btn btn-primary" onclick="addSecondary()" id="addBtn">‚ûï Add Secondary</button>
            <button class="btn btn-primary" onclick="recoverMember()" id="recoverBtn" disabled>üîß Recover Failed Member</button>
            <button class="btn btn-primary" onclick="triggerElectionIfNeeded()" id="electionBtn">üó≥Ô∏è Force Election Check</button>
            <button class="btn btn-primary" onclick="performWrite()">‚úçÔ∏è Write Data</button>
            <button class="btn btn-primary" onclick="performRead()">üìñ Read Data</button>
            <button class="btn btn-primary" onclick="resetDemo()">üîÑ Reset Demo</button>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="uptimePercent">100.0%</div>
                <div class="stat-label">Write Availability</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="replicaCount">3</div>
                <div class="stat-label">Replica Members</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="writeCount">0</div>
                <div class="stat-label">Writes Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="readCount">0</div>
                <div class="stat-label">Reads Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="writeRetries">0</div>
                <div class="stat-label">Write Retries</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="readRetries">0</div>
                <div class="stat-label">Read Retries</div>
            </div>
        </div>

        <div class="architecture-section">
            <h3>üèóÔ∏è MongoDB Replica Set Architecture</h3>
            <div class="replica-set-container">
                <div class="replica-set-title">Replica Set: "myReplicaSet"</div>
                <div class="replication-flow" id="replicationFlow"></div>
                <div class="replica-members" id="replicaMembers">
                    <!-- Replica members will be rendered here -->
                </div>
            </div>
        </div>

        <div class="read-preferences">
            <h3>üìñ Read Preference Options</h3>
            <div class="read-option active" onclick="setReadPreference('primary')">
                <input type="radio" name="readPref" value="primary" checked>
                <div>
                    <strong>Primary</strong> - All reads from primary (strong consistency)
                </div>
            </div>
            <div class="read-option" onclick="setReadPreference('primaryPreferred')">
                <input type="radio" name="readPref" value="primaryPreferred">
                <div>
                    <strong>Primary Preferred</strong> - Primary first, then secondaries
                </div>
            </div>
            <div class="read-option" onclick="setReadPreference('secondary')">
                <input type="radio" name="readPref" value="secondary">
                <div>
                    <strong>Secondary</strong> - Only from secondaries (read scaling)
                </div>
            </div>
            <div class="read-option" onclick="setReadPreference('secondaryPreferred')">
                <input type="radio" name="readPref" value="secondaryPreferred">
                <div>
                    <strong>Secondary Preferred</strong> - Secondaries first, then primary
                </div>
            </div>
        </div>

        <div class="log-container">
            <h3>üìä Replica Set Activity Log</h3>
            <div class="log-content" id="logContainer"></div>
        </div>
    </div>

    <script>
        // Global state
        let replicaMembers = [
            { id: 1, role: 'primary', status: 'healthy', host: 'rs-primary-001', port: 27017, lag: 0, priority: 1, term: 1 },
            { id: 2, role: 'secondary', status: 'healthy', host: 'rs-secondary-001', port: 27017, lag: 0, priority: 1, term: 1 },
            { id: 3, role: 'secondary', status: 'healthy', host: 'rs-secondary-002', port: 27017, lag: 0, priority: 1, term: 1 }
        ];
        
        let nextMemberId = 4;
        let writeCount = 0;
        let readCount = 0;
        let currentReadPreference = 'primary';
        let failedMembers = [];
        let electionInProgress = false;  // Prevent concurrent elections
        let currentTerm = 1;  // Global term number
        let noPrimaryStartTime = null;  // Track when system goes into no-primary state
        
        // Retryable operations tracking
        let writeRetryCount = 0;
        let readRetryCount = 0;
        let writeFailureCount = 0;
        let readFailureCount = 0;

        // Logging function
        function logMessage(message, type = 'info') {
            const container = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        // Update statistics
        function updateStats() {
            // Simple logic: Primary available = 100%, No primary = 0%
            const healthyPrimary = replicaMembers.find(m => m.role === 'primary' && m.status === 'healthy');
            const writeAvailability = healthyPrimary ? 100.0 : 0.0;
            
            document.getElementById('uptimePercent').textContent = writeAvailability.toFixed(1) + '%';
            document.getElementById('replicaCount').textContent = replicaMembers.length;
            document.getElementById('writeCount').textContent = writeCount;
            document.getElementById('readCount').textContent = readCount;
            document.getElementById('writeRetries').textContent = writeRetryCount;
            document.getElementById('readRetries').textContent = readRetryCount;
        }

        // Check if majority of voting members are available
        function hasMajority() {
            const totalVotingMembers = replicaMembers.length;
            const healthyMembers = replicaMembers.filter(m => m.status === 'healthy').length;
            const majorityRequired = Math.floor(totalVotingMembers / 2) + 1;
            
            return healthyMembers >= majorityRequired;
        }

        // Render replica set visualization
        function renderReplicaSet() {
            const container = document.getElementById('replicaMembers');
            container.innerHTML = '';

            // Check if we have majority and a primary
            const hasMaj = hasMajority();
            const healthyPrimary = replicaMembers.find(m => m.role === 'primary' && m.status === 'healthy');
            
            // Add majority status indicator
            if (!hasMaj) {
                const majorityWarning = document.createElement('div');
                majorityWarning.style.cssText = `
                    grid-column: 1 / -1;
                    background: linear-gradient(135deg, #FDE8E8 0%, #FFF0F0 100%);
                    border: 2px solid #FF6B6B;
                    border-radius: 12px;
                    padding: 15px;
                    text-align: center;
                    margin-bottom: 20px;
                    color: #D32F2F;
                    font-weight: 600;
                `;
                const totalMembers = replicaMembers.length;
                const healthyMembers = replicaMembers.filter(m => m.status === 'healthy').length;
                const majorityRequired = Math.floor(totalMembers / 2) + 1;
                
                majorityWarning.innerHTML = `
                    üö´ <strong>NO MAJORITY AVAILABLE</strong><br>
                    ${healthyMembers}/${totalMembers} healthy (need ${majorityRequired} for primary election)<br>
                    <small>Writes unavailable until majority is restored</small>
                `;
                container.appendChild(majorityWarning);
            }

            replicaMembers.forEach(member => {
                const memberDiv = document.createElement('div');
                memberDiv.className = `replica-member ${member.role} ${member.status === 'down' ? 'down' : ''} ${member.status === 'recovering' ? 'recovering' : ''}`;
                memberDiv.id = `member-${member.id}`;

                let statusClass = 'status-healthy';
                let statusText = 'Healthy';
                
                if (member.status === 'down') {
                    statusClass = 'status-down';
                    statusText = 'Down';
                } else if (member.status === 'recovering') {
                    statusClass = 'status-syncing';
                    statusText = 'Syncing';
                }

                // Special handling for primary role display when no majority
                let roleDisplay = member.role.charAt(0).toUpperCase() + member.role.slice(1);
                if (member.role === 'primary' && !healthyPrimary && member.status === 'down') {
                    roleDisplay = 'Former Primary';
                }

                memberDiv.innerHTML = `
                    <div class="member-role ${member.role} ${member.status === 'down' ? 'down' : ''} ${member.status === 'recovering' ? 'recovering' : ''}">
                        ${roleDisplay}
                    </div>
                    <div class="member-details">
                        <div><strong>${member.host}</strong></div>
                        <div>Port: ${member.port}</div>
                        <div class="member-status ${statusClass}">${statusText}</div>
                        ${member.status === 'healthy' ? `<div style="font-size: 0.8em; color: #666;">Term: ${member.term} | Priority: ${member.priority}</div>` : ''}
                        ${member.role === 'secondary' && member.status === 'healthy' ? `<div style="font-size: 0.8em; color: #666;">Lag: ${member.lag}ms</div>` : ''}
                    </div>
                `;

                container.appendChild(memberDiv);
            });

            updateStats();
        }

        // MongoDB-style election algorithm
        function conductElection(triggerReason = 'unknown') {
            // Prevent concurrent elections
            if (electionInProgress) {
                logMessage('üó≥Ô∏è Election already in progress, skipping...', 'warning');
                return;
            }

            // Check if majority exists
            if (!hasMajority()) {
                const totalMembers = replicaMembers.length;
                const healthyMembers = replicaMembers.filter(m => m.status === 'healthy').length;
                const majorityRequired = Math.floor(totalMembers / 2) + 1;
                logMessage(`‚ùå Cannot start election: No majority (${healthyMembers}/${totalMembers}, need ${majorityRequired})`, 'error');
                return;
            }

            // Check if we already have a healthy primary
            const existingPrimary = replicaMembers.find(m => m.role === 'primary' && m.status === 'healthy');
            if (existingPrimary) {
                logMessage(`‚úÖ Primary already exists: ${existingPrimary.host} (term ${existingPrimary.term})`, 'info');
                return;
            }

            electionInProgress = true;
            currentTerm++; // Increment term for this election
            
            logMessage(`üó≥Ô∏è Starting election (term ${currentTerm}) - reason: ${triggerReason}`, 'warning');

            // Step 1: Dry Election - find best candidate
            const eligibleCandidates = replicaMembers.filter(m => 
                m.status === 'healthy' && m.priority > 0
            );

            if (eligibleCandidates.length === 0) {
                logMessage('‚ùå No eligible candidates for election', 'error');
                electionInProgress = false;
                return;
            }

            // Step 2: Select candidate based on MongoDB's rules:
            // 1. Highest priority
            // 2. Most recent data (lowest lag as proxy for optime)
            // 3. Lowest member ID (tiebreaker)
            eligibleCandidates.sort((a, b) => {
                if (a.priority !== b.priority) return b.priority - a.priority; // Higher priority first
                if (a.lag !== b.lag) return a.lag - b.lag; // Lower lag (fresher data) first
                return a.id - b.id; // Lower ID as tiebreaker
            });

            const candidate = eligibleCandidates[0];
            
            logMessage(`üèÜ Best candidate: ${candidate.host} (priority: ${candidate.priority}, lag: ${candidate.lag}ms)`, 'info');

            // Step 3: Voting process (simplified)
            setTimeout(() => {
                const healthyVotingMembers = replicaMembers.filter(m => m.status === 'healthy');
                const votesNeeded = Math.floor(healthyVotingMembers.length / 2) + 1;
                const votesReceived = healthyVotingMembers.length; // All healthy members vote for best candidate
                
                if (votesReceived >= votesNeeded) {
                    // Step 4: Step down any existing primaries (even failed ones)
                    replicaMembers.forEach(member => {
                        if (member.role === 'primary') {
                            member.role = 'secondary';
                            if (member.status === 'healthy') {
                                logMessage(`üìâ ${member.host} stepped down from primary (lower term)`, 'info');
                            }
                        }
                    });

                    // Step 5: Elect new primary
                    candidate.role = 'primary';
                    candidate.term = currentTerm;
                    candidate.lag = 0; // Primary has no lag
                    
                    // Update all members to current term
                    replicaMembers.forEach(member => {
                        if (member.status === 'healthy') {
                            member.term = currentTerm;
                        }
                    });

                    const totalMembers = replicaMembers.length;
                    const healthyMembers = replicaMembers.filter(m => m.status === 'healthy').length;
                    
                    logMessage(`‚úÖ Election successful! ${candidate.host} elected PRIMARY`, 'success');
                    logMessage(`üìä Votes: ${votesReceived}/${healthyVotingMembers.length} (needed ${votesNeeded})`, 'success');
                    logMessage(`üè∑Ô∏è New term: ${currentTerm}`, 'info');
                    logMessage('üîÑ Replica set is operational', 'success');
                } else {
                    logMessage(`‚ùå Election failed: insufficient votes (${votesReceived}/${votesNeeded})`, 'error');
                }

                electionInProgress = false;
                renderReplicaSet();
            }, 3000); // 3-second election process
        }

        // Simulate primary failure and election
        function simulateFailure() {
            const primary = replicaMembers.find(m => m.role === 'primary');
            if (!primary) {
                logMessage('No primary to fail!', 'warning');
                return;
            }

            logMessage(`üí• Primary ${primary.host} has failed!`, 'error');
            primary.status = 'down';
            primary.role = 'secondary'; // Failed primary becomes secondary
            failedMembers.push(primary.id);
            
            document.getElementById('failureBtn').disabled = true;
            document.getElementById('recoverBtn').disabled = false;

            renderReplicaSet();

            // Trigger election after brief delay (simulates heartbeat timeout)
            setTimeout(() => {
                conductElection('primary failure');
                document.getElementById('failureBtn').disabled = false;
            }, 1000);
        }

        // Wrapper function for backward compatibility and manual triggers
        function triggerElectionIfNeeded() {
            conductElection('manual trigger');
        }

        // Add a new secondary member
        function addSecondary() {
            const newMember = {
                id: nextMemberId++,
                role: 'secondary',
                status: 'recovering',
                host: `rs-secondary-${String(nextMemberId - 1).padStart(3, '0')}`,
                port: 27017,
                lag: 5000,
                priority: 1,
                term: currentTerm
            };

            replicaMembers.push(newMember);
            logMessage(`‚ûï Adding new secondary: ${newMember.host}`, 'warning');
            logMessage('üìä Initial sync started...', 'warning');
            
            renderReplicaSet();

            // Simulate initial sync process
            setTimeout(() => {
                newMember.status = 'healthy';
                newMember.lag = Math.floor(Math.random() * 100) + 10;
                logMessage(`‚úÖ ${newMember.host} sync complete - now accepting reads`, 'success');
                renderReplicaSet();
                
                // Check if this new member enables an election
                setTimeout(() => conductElection('new member joined'), 1000);
            }, 4000);
        }

        // Recover a failed member
        function recoverMember() {
            if (failedMembers.length === 0) {
                logMessage('No failed members to recover', 'warning');
                return;
            }

            const memberId = failedMembers.pop();
            const member = replicaMembers.find(m => m.id === memberId);
            
            if (member) {
                logMessage(`üîß Recovering ${member.host}...`, 'warning');
                member.status = 'recovering';
                renderReplicaSet();

                setTimeout(() => {
                    member.status = 'healthy';
                    member.lag = Math.floor(Math.random() * 200) + 50;
                    member.term = currentTerm; // Update to current term
                    logMessage(`‚úÖ ${member.host} recovered and synced`, 'success');
                    renderReplicaSet();
                    
                    // Check if this recovery enables an election
                    setTimeout(() => conductElection('member recovery'), 1000);
                    
                    if (failedMembers.length === 0) {
                        document.getElementById('recoverBtn').disabled = true;
                    }
                }, 3000);
            }
        }

        // Simulate retryable write operation (MongoDB driver behavior)
        function performWrite() {
            // First attempt
            logMessage('üìù Attempting write operation...', 'info');
            
            // Check for various failure scenarios that trigger retries
            const primary = replicaMembers.find(m => m.role === 'primary' && m.status === 'healthy');
            const isElectionInProgress = electionInProgress;
            const simulateNetworkError = Math.random() < 0.1; // 10% chance of transient network error
            
            // First attempt - check for immediate failures
            if (!primary && !hasMajority()) {
                writeFailureCount++;
                logMessage('‚ùå Write failed: No primary available and no majority for election', 'error');
                logMessage('üö´ Operation cannot be retried - insufficient nodes', 'error');
                return;
            }
            
            // Simulate first attempt failure scenarios
            if (!primary || isElectionInProgress || simulateNetworkError) {
                let failureReason = '';
                if (!primary) failureReason = 'no primary (election needed)';
                else if (isElectionInProgress) failureReason = 'election in progress';
                else if (simulateNetworkError) failureReason = 'network timeout';
                
                logMessage(`‚ö†Ô∏è Write attempt 1 failed: ${failureReason}`, 'warning');
                logMessage('üîÑ Driver initiating automatic retry...', 'warning');
                writeRetryCount++;
                
                // MongoDB driver waits briefly then retries
                setTimeout(() => {
                    // Second attempt - retry logic
                    const retryPrimary = replicaMembers.find(m => m.role === 'primary' && m.status === 'healthy');
                    const retryElectionInProgress = electionInProgress;
                    
                    if (retryPrimary && !retryElectionInProgress) {
                        // Retry succeeded
                        writeCount++;
                        logMessage(`‚úÖ Write retry succeeded on ${retryPrimary.host}`, 'success');
                        logMessage('üéØ Retryable writes: Application unaware of initial failure', 'success');
                        
                        // Show replication flow animation
                        const flow = document.getElementById('replicationFlow');
                        flow.classList.add('active');
                        
                        setTimeout(() => {
                            flow.classList.remove('active');
                            logMessage('üì§ Data replicated to all healthy secondaries', 'success');
                            
                            // Update secondary lag
                            replicaMembers.forEach(member => {
                                if (member.role === 'secondary' && member.status === 'healthy') {
                                    member.lag = Math.floor(Math.random() * 100) + 10;
                                }
                            });
                            renderReplicaSet();
                        }, 2000);
                    } else {
                        // Retry also failed
                        writeFailureCount++;
                        let retryFailureReason = !retryPrimary ? 'still no primary' : 'election still in progress';
                        logMessage(`‚ùå Write retry failed: ${retryFailureReason}`, 'error');
                        logMessage('üö´ Driver exhausted retries - returning error to application', 'error');
                    }
                    
                    updateStats();
                }, 1500); // 1.5 second retry delay
                
            } else {
                // First attempt succeeded
                writeCount++;
                logMessage(`‚úÖ Write succeeded on ${primary.host}`, 'success');
                
                // Show replication flow animation
                const flow = document.getElementById('replicationFlow');
                flow.classList.add('active');
                
                setTimeout(() => {
                    flow.classList.remove('active');
                    logMessage('üì§ Data replicated to all healthy secondaries', 'success');
                    
                    // Update secondary lag
                    replicaMembers.forEach(member => {
                        if (member.role === 'secondary' && member.status === 'healthy') {
                            member.lag = Math.floor(Math.random() * 100) + 10;
                        }
                    });
                    renderReplicaSet();
                }, 2000);
            }
            
            updateStats();
        }

        // Simulate retryable read operation (MongoDB driver behavior)
        function performRead() {
            logMessage('üìñ Attempting read operation...', 'info');
            
            // Simulate network errors or temporary unavailability
            const simulateNetworkError = Math.random() < 0.15; // 15% chance of transient network error
            const simulateSecondaryLag = Math.random() < 0.1; // 10% chance secondary is too far behind
            
            let targetMember = null;
            const healthyPrimary = replicaMembers.find(m => m.role === 'primary' && m.status === 'healthy');
            const healthySecondaries = replicaMembers.filter(m => m.role === 'secondary' && m.status === 'healthy');

            // Determine target based on read preference
            switch (currentReadPreference) {
                case 'primary':
                    targetMember = healthyPrimary;
                    break;
                case 'primaryPreferred':
                    targetMember = healthyPrimary || (healthySecondaries.length > 0 ? healthySecondaries[0] : null);
                    break;
                case 'secondary':
                    targetMember = healthySecondaries.length > 0 ? healthySecondaries[Math.floor(Math.random() * healthySecondaries.length)] : null;
                    break;
                case 'secondaryPreferred':
                    targetMember = healthySecondaries.length > 0 ? healthySecondaries[Math.floor(Math.random() * healthySecondaries.length)] : healthyPrimary;
                    break;
            }

            // First attempt
            if (!targetMember || simulateNetworkError || (targetMember.role === 'secondary' && simulateSecondaryLag)) {
                let failureReason = '';
                if (!targetMember) failureReason = `no healthy members for read preference: ${currentReadPreference}`;
                else if (simulateNetworkError) failureReason = 'network timeout to selected member';
                else if (simulateSecondaryLag) failureReason = 'secondary too far behind (exceeds maxStalenessSeconds)';
                
                logMessage(`‚ö†Ô∏è Read attempt 1 failed: ${failureReason}`, 'warning');
                logMessage('üîÑ Driver initiating automatic retry with different member...', 'warning');
                readRetryCount++;
                
                // Retry with different logic
                setTimeout(() => {
                    let retryTargetMember = null;
                    
                    // For retries, MongoDB often falls back to more permissive selection
                    if (currentReadPreference === 'secondary' && healthyPrimary) {
                        // Fall back to primary if secondaries are having issues
                        retryTargetMember = healthyPrimary;
                        logMessage('üìã Retry: Falling back to primary due to secondary issues', 'info');
                    } else {
                        // Try different member of same type
                        switch (currentReadPreference) {
                            case 'primary':
                                retryTargetMember = healthyPrimary;
                                break;
                            case 'primaryPreferred':
                                retryTargetMember = healthyPrimary || (healthySecondaries.length > 0 ? healthySecondaries[0] : null);
                                break;
                            case 'secondary':
                                retryTargetMember = healthySecondaries.length > 0 ? healthySecondaries[Math.floor(Math.random() * healthySecondaries.length)] : null;
                                break;
                            case 'secondaryPreferred':
                                retryTargetMember = healthySecondaries.length > 0 ? healthySecondaries[Math.floor(Math.random() * healthySecondaries.length)] : healthyPrimary;
                                break;
                        }
                    }
                    
                    if (retryTargetMember) {
                        readCount++;
                        logMessage(`‚úÖ Read retry succeeded from ${retryTargetMember.host} (${retryTargetMember.role})`, 'success');
                        logMessage('üéØ Retryable reads: Application unaware of initial failure', 'success');
                    } else {
                        readFailureCount++;
                        logMessage(`‚ùå Read retry failed: No suitable members available`, 'error');
                        logMessage('üö´ Driver exhausted retries - returning error to application', 'error');
                    }
                    
                    updateStats();
                }, 1000); // 1 second retry delay
                
            } else {
                // First attempt succeeded
                readCount++;
                logMessage(`‚úÖ Read succeeded from ${targetMember.host} (${targetMember.role})`, 'success');
            }
            
            updateStats();
        }

        // Set read preference
        function setReadPreference(preference) {
            currentReadPreference = preference;
            
            // Update UI
            document.querySelectorAll('.read-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.closest('.read-option').classList.add('active');
            
            // Update radio button
            document.querySelector(`input[value="${preference}"]`).checked = true;
            
            logMessage(`üìã Read preference changed to: ${preference}`, 'info');
        }

        // Reset demo
        function resetDemo() {
            replicaMembers = [
                { id: 1, role: 'primary', status: 'healthy', host: 'rs-primary-001', port: 27017, lag: 0, priority: 1, term: 1 },
                { id: 2, role: 'secondary', status: 'healthy', host: 'rs-secondary-001', port: 27017, lag: 0, priority: 1, term: 1 },
                { id: 3, role: 'secondary', status: 'healthy', host: 'rs-secondary-002', port: 27017, lag: 0, priority: 1, term: 1 }
            ];
            
            nextMemberId = 4;
            writeCount = 0;
            readCount = 0;
            uptimeStart = Date.now();
            totalDowntime = 0;
            failedMembers = [];
            electionInProgress = false;
            currentTerm = 1;
            noPrimaryStartTime = null;
            
            document.getElementById('failureBtn').disabled = false;
            document.getElementById('recoverBtn').disabled = true;
            document.getElementById('logContainer').innerHTML = '';
            
            renderReplicaSet();
            logMessage('üîÑ Demo reset to initial 3-member replica set', 'info');
            logMessage('üéØ Replica set initialized with term 1', 'success');
        }

        // Toggle demo overview section
        function toggleDemoOverview() {
            const overview = document.getElementById('demoOverview');
            const toggle = document.getElementById('demoToggle');
            
            if (overview.style.display === 'none') {
                overview.style.display = 'block';
                toggle.textContent = '‚ñ≤';
                toggle.style.transform = 'rotate(180deg)';
            } else {
                overview.style.display = 'none';
                toggle.textContent = '‚ñº';
                toggle.style.transform = 'rotate(0deg)';
            }
        }

        // Accordion functionality
        function toggleAccordion(categoryId) {
            const content = document.getElementById(categoryId + '-content');
            const icon = document.getElementById(categoryId + '-icon');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                icon.classList.remove('rotated');
            } else {
                content.classList.add('expanded');
                icon.classList.add('rotated');
            }
        }

        // Initialize accordion - expand category containing current page
        function initializeAccordion() {
            const content = document.getElementById('architecture-content');
            const icon = document.getElementById('architecture-icon');
            content.classList.add('expanded');
            icon.classList.add('rotated');
        }

        // Mobile menu functionality
        function toggleMobileMenu() {
            const navMenu = document.getElementById('navMenu');
            navMenu.classList.toggle('open');
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const navMenu = document.getElementById('navMenu');
            const toggleButton = document.querySelector('.mobile-menu-toggle');
            
            if (!navMenu.contains(event.target) && !toggleButton.contains(event.target)) {
                navMenu.classList.remove('open');
            }
        });

        // Initialize on page load
        window.addEventListener('load', function() {
            initializeAccordion();
        });

        // Initialize demo
        window.onload = function() {
            renderReplicaSet();
            logMessage('üéâ MongoDB Replica Set demo initialized', 'success');
            logMessage('üîß 3-member replica set active with automatic failover', 'info');
            logMessage('üìä Election algorithm: Priority-based with term management', 'info');
            logMessage('üîÑ Retryable operations: Automatic driver resilience enabled', 'info');
            logMessage('üöÄ Try performing operations during failures to see retries!', 'info');
        };
    </script>
</body>
</html>
